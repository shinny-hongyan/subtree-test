import{timeFormat as t,scaleLinear as e,axisBottom as i,timeSecond as s,timeMinute as r,timeHour as n,timeDay as a,timeMonth as o,timeYear as h,axisLeft as l,axisRight as d,min as c,max as u,select as f,mouse as m,drag as g,event as p,zoom as y}from"d3";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function _(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function v(t,e){return t(e={exports:{}},e.exports),e.exports}var b=v((function(t){var e=t.exports={version:"2.6.10"};"number"==typeof __e&&(__e=e)})),x=(b.version,v((function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}))),w=v((function(t){var e=x["__core-js_shared__"]||(x["__core-js_shared__"]={});(t.exports=function(t,i){return e[t]||(e[t]=void 0!==i?i:{})})("versions",[]).push({version:b.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),k=0,S=Math.random(),M=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++k+S).toString(36))},D=v((function(t){var e=w("wks"),i=x.Symbol,s="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=s&&i[t]||(s?i:M)("Symbol."+t))}).store=e})),P=function(t){return"object"==typeof t?null!==t:"function"==typeof t},Y=function(t){if(!P(t))throw TypeError(t+" is not an object!");return t},T=function(t){try{return!!t()}catch(t){return!0}},O=!T((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),I=x.document,A=P(I)&&P(I.createElement),W=function(t){return A?I.createElement(t):{}},N=!O&&!T((function(){return 7!=Object.defineProperty(W("div"),"a",{get:function(){return 7}}).a})),G=Object.defineProperty,C={f:O?Object.defineProperty:function(t,e,i){if(Y(t),e=function(t,e){if(!P(t))return t;var i,s;if(e&&"function"==typeof(i=t.toString)&&!P(s=i.call(t)))return s;if("function"==typeof(i=t.valueOf)&&!P(s=i.call(t)))return s;if(!e&&"function"==typeof(i=t.toString)&&!P(s=i.call(t)))return s;throw TypeError("Can't convert object to primitive value")}(e,!0),Y(i),N)try{return G(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},H=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},L=O?function(t,e,i){return C.f(t,e,H(1,i))}:function(t,e,i){return t[e]=i,t},F=D("unscopables"),R=Array.prototype;null==R[F]&&L(R,F,{});var q=function(t){R[F][t]=!0},E=function(t,e){return{value:e,done:!!t}},$={},j={}.toString,V=function(t){return j.call(t).slice(8,-1)},U=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==V(t)?t.split(""):Object(t)},z=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},B=function(t){return U(z(t))},Z={}.hasOwnProperty,K=function(t,e){return Z.call(t,e)},J=w("native-function-to-string",Function.toString),X=v((function(t){var e=M("src"),i=(""+J).split("toString");b.inspectSource=function(t){return J.call(t)},(t.exports=function(t,s,r,n){var a="function"==typeof r;a&&(K(r,"name")||L(r,"name",s)),t[s]!==r&&(a&&(K(r,e)||L(r,e,t[s]?""+t[s]:i.join(String(s)))),t===x?t[s]=r:n?t[s]?t[s]=r:L(t,s,r):(delete t[s],L(t,s,r)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[e]||J.call(this)}))})),Q=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},tt=function(t,e,i){if(Q(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,s){return t.call(e,i,s)};case 3:return function(i,s,r){return t.call(e,i,s,r)}}return function(){return t.apply(e,arguments)}},et=function(t,e,i){var s,r,n,a,o=t&et.F,h=t&et.G,l=t&et.S,d=t&et.P,c=t&et.B,u=h?x:l?x[e]||(x[e]={}):(x[e]||{}).prototype,f=h?b:b[e]||(b[e]={}),m=f.prototype||(f.prototype={});for(s in h&&(i=e),i)n=((r=!o&&u&&void 0!==u[s])?u:i)[s],a=c&&r?tt(n,x):d&&"function"==typeof n?tt(Function.call,n):n,u&&X(u,s,n,t&et.U),f[s]!=n&&L(f,s,a),d&&m[s]!=n&&(m[s]=n)};x.core=b,et.F=1,et.G=2,et.S=4,et.P=8,et.B=16,et.W=32,et.U=64,et.R=128;var it,st=et,rt=Math.ceil,nt=Math.floor,at=function(t){return isNaN(t=+t)?0:(t>0?nt:rt)(t)},ot=Math.min,ht=function(t){return t>0?ot(at(t),9007199254740991):0},lt=Math.max,dt=Math.min,ct=w("keys"),ut=function(t){return ct[t]||(ct[t]=M(t))},ft=(it=!1,function(t,e,i){var s,r=B(t),n=ht(r.length),a=function(t,e){return(t=at(t))<0?lt(t+e,0):dt(t,e)}(i,n);if(it&&e!=e){for(;n>a;)if((s=r[a++])!=s)return!0}else for(;n>a;a++)if((it||a in r)&&r[a]===e)return it||a||0;return!it&&-1}),mt=ut("IE_PROTO"),gt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),pt=Object.keys||function(t){return function(t,e){var i,s=B(t),r=0,n=[];for(i in s)i!=mt&&K(s,i)&&n.push(i);for(;e.length>r;)K(s,i=e[r++])&&(~ft(n,i)||n.push(i));return n}(t,gt)},yt=O?Object.defineProperties:function(t,e){Y(t);for(var i,s=pt(e),r=s.length,n=0;r>n;)C.f(t,i=s[n++],e[i]);return t},_t=x.document,vt=_t&&_t.documentElement,bt=ut("IE_PROTO"),xt=function(){},wt=function(){var t,e=W("iframe"),i=gt.length;for(e.style.display="none",vt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),wt=t.F;i--;)delete wt.prototype[gt[i]];return wt()},kt=Object.create||function(t,e){var i;return null!==t?(xt.prototype=Y(t),i=new xt,xt.prototype=null,i[bt]=t):i=wt(),void 0===e?i:yt(i,e)},St=C.f,Mt=D("toStringTag"),Dt=function(t,e,i){t&&!K(t=i?t:t.prototype,Mt)&&St(t,Mt,{configurable:!0,value:e})},Pt={};L(Pt,D("iterator"),(function(){return this}));var Yt=function(t,e,i){t.prototype=kt(Pt,{next:H(1,i)}),Dt(t,e+" Iterator")},Tt=function(t){return Object(z(t))},Ot=ut("IE_PROTO"),It=Object.prototype,At=Object.getPrototypeOf||function(t){return t=Tt(t),K(t,Ot)?t[Ot]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?It:null},Wt=D("iterator"),Nt=!([].keys&&"next"in[].keys()),Gt=function(){return this},Ct=function(t,e,i,s,r,n,a){Yt(i,e,s);var o,h,l,d=function(t){if(!Nt&&t in m)return m[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},c=e+" Iterator",u="values"==r,f=!1,m=t.prototype,g=m[Wt]||m["@@iterator"]||r&&m[r],p=g||d(r),y=r?u?d("entries"):p:void 0,_="Array"==e&&m.entries||g;if(_&&(l=At(_.call(new t)))!==Object.prototype&&l.next&&(Dt(l,c,!0),"function"!=typeof l[Wt]&&L(l,Wt,Gt)),u&&g&&"values"!==g.name&&(f=!0,p=function(){return g.call(this)}),(Nt||f||!m[Wt])&&L(m,Wt,p),$[e]=p,$[c]=Gt,r)if(o={values:u?p:d("values"),keys:n?p:d("keys"),entries:y},a)for(h in o)h in m||X(m,h,o[h]);else st(st.P+st.F*(Nt||f),e,o);return o}(Array,"Array",(function(t,e){this._t=B(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,E(1)):E(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])}),"values");$.Arguments=$.Array,q("keys"),q("values"),q("entries");for(var Ht=D("iterator"),Lt=D("toStringTag"),Ft=$.Array,Rt={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},qt=pt(Rt),Et=0;Et<qt.length;Et++){var $t,jt=qt[Et],Vt=Rt[jt],Ut=x[jt],zt=Ut&&Ut.prototype;if(zt&&(zt[Ht]||L(zt,Ht,Ft),zt[Lt]||L(zt,Lt,jt),$[jt]=Ft,Vt))for($t in Ct)zt[$t]||X(zt,$t,Ct[$t],!0)}function Bt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],s=!0,r=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){r=!0,n=t}finally{try{s||null==o.return||o.return()}finally{if(r)throw n}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Zt=v((function(t){var e=Object.prototype.hasOwnProperty,i="~";function s(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,s,n,a){if("function"!=typeof s)throw new TypeError("The listener must be a function");var o=new r(s,n||t,a),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],o]:t._events[h].push(o):(t._events[h]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function o(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),o.prototype.eventNames=function(){var t,s,r=[];if(0===this._eventsCount)return r;for(s in t=this._events)e.call(t,s)&&r.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},o.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,n=s.length,a=new Array(n);r<n;r++)a[r]=s[r].fn;return a},o.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},o.prototype.emit=function(t,e,s,r,n,a){var o=i?i+t:t;if(!this._events[o])return!1;var h,l,d=this._events[o],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,s),!0;case 4:return d.fn.call(d.context,e,s,r),!0;case 5:return d.fn.call(d.context,e,s,r,n),!0;case 6:return d.fn.call(d.context,e,s,r,n,a),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];d.fn.apply(d.context,h)}else{var u,f=d.length;for(l=0;l<f;l++)switch(d[l].once&&this.removeListener(t,d[l].fn,void 0,!0),c){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,e);break;case 3:d[l].fn.call(d[l].context,e,s);break;case 4:d[l].fn.call(d[l].context,e,s,r);break;default:if(!h)for(u=1,h=new Array(c-1);u<c;u++)h[u-1]=arguments[u];d[l].fn.apply(d[l].context,h)}}return!0},o.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},o.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},o.prototype.removeListener=function(t,e,s,r){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return a(this,n),this;var o=this._events[n];if(o.fn)o.fn!==e||r&&!o.once||s&&o.context!==s||a(this,n);else{for(var h=0,l=[],d=o.length;h<d;h++)(o[h].fn!==e||r&&!o[h].once||s&&o[h].context!==s)&&l.push(o[h]);l.length?this._events[n]=1===l.length?l[0]:l:a(this,n)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&a(this,e)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o}));const Kt=t(".%L"),Jt=t(":%S"),Xt=t("%H:%M"),Qt=t("%H:%M"),te=t("%m%d"),ee=t("%m%d"),ie=t("%y");class se{constructor(t){this.chart=t,this.xScale=e(),this.xAxis=i().scale(this.xScale),this._init()}_init(){this.rootG=this.chart.rootG.append("g").attr("class","x axis"),this.resetPosition()}resetPosition(){this.rootG.attr("transform","translate("+Math.floor(this.chart.bar.barWidth/2)+","+(this.chart.innerHeight+1)+")"),this.xScale.rangeRound([0,this.chart.bar.barNumbers*this.chart.bar.barWidth-this.chart.bar.barWidth])}draw(t,e,i){this.xScale.domain([t,e]),this.xAxis.tickFormat((t,e)=>i[t]&&i[t].datetime?function(t){return(s(t)<t?Kt:r(t)<t?Jt:n(t)<t?Xt:a(t)<t?Qt:o(t)<t?te:h(t)<t?ee:ie)(t)}(i[t].datetime/1e6):""),this.rootG.call(this.xAxis)}}function re(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=Number(t),s=Number.isInteger(e)?e:2;return Number.isFinite(i)?i.toFixed(s):t}class ne{constructor(t){this.tqchart=t,this.svgG=this.tqchart.svg.append("g").attr("class","crosshair-container").attr("visibility","hidden"),this.rootG=this.svgG.append("g").attr("class","crosshair-content").attr("transform","translate("+this.tqchart.margin.left+","+this.tqchart.margin.top+")"),this.rectG=this.rootG.append("rect").attr("class","crosshair-cursor").attr("width",this.tqchart.innerWidth).attr("height",this.tqchart.innerHeight),this.klinePanel=this.svgG.append("g").attr("class","kline panel"),this.klinePanelWidth=100,this.klinePanelHeight=144,this.klinePanelDefaultColor="#333333",this.klinePanel.append("rect").attr("x",.5).attr("y",.5).attr("width",this.klinePanelWidth).attr("height",this.klinePanelHeight).attr("stroke","#DDDDDD"),this.klinePanel.append("text").attr("x",0).attr("y",0),this._initCrosshairline(),this._initAxisannotation()}_initCrosshairline(){this.rootG.append("g").attr("class","crosshair horizontal").append("line").attr("x1",0).attr("y1",0).attr("x2",this.tqchart.innerWidth).attr("y2",0).attr("stroke","#aaaaaa").attr("stroke-dasharray","2"),this.rootG.append("g").attr("class","crosshair vertical").append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this.tqchart.innerHeight).attr("stroke","#aaaaaa").attr("stroke-dasharray","2")}_initAxisannotation(){this.rootG.append("g").attr("class","axisannotation x").attr("transform","translate(0,"+(this.tqchart.innerHeight+2)+")"),this.rootG.append("g").attr("class","axisannotation y left").attr("transform","translate(-"+(this.tqchart.margin.left-1)+",0)"),this.rootG.append("g").attr("class","axisannotation y right").attr("transform","translate("+(this.tqchart.innerWidth+1)+",0)"),this.rootG.select("g.axisannotation.x").append("rect").style("fill","#eeeeee").attr("opacity","0.8").attr("width","120px").attr("height","14px"),this.rootG.select("g.axisannotation.x").append("text").attr("x",1).attr("y",12),this.rootG.select("g.axisannotation.y.left").append("rect").style("fill","#FAFAFA").attr("opacity","0.9").attr("width",this.tqchart.margin.left-2).attr("height","16px"),this.rootG.select("g.axisannotation.y.left").append("text").attr("x",this.tqchart.margin.left-2).attr("y",13).attr("text-anchor","end"),this.rootG.select("g.axisannotation.y.right").append("rect").style("fill","#FAFAFA").attr("opacity","0.9").attr("width",this.tqchart.margin.right-2).attr("height","16px"),this.rootG.select("g.axisannotation.y.right").append("text").attr("x",2).attr("y",13)}resize(){this.rectG.attr("width",this.tqchart.innerWidth).attr("height",this.tqchart.innerHeight),this.rootG.select("g.crosshair.horizontal line").attr("x2",this.tqchart.innerWidth),this.rootG.select("g.crosshair.vertical line").attr("y2",this.tqchart.innerHeight),this.rootG.select("g.axisannotation.x").attr("transform","translate(0,"+this.tqchart.innerHeight+")"),this.rootG.select("g.axisannotation.y.right").attr("transform","translate("+(this.tqchart.innerWidth+1)+",0)")}update(t,e){const i=Math.floor(t/this.tqchart.bar.barWidth),s=i*this.tqchart.bar.barWidth+this.tqchart.bar.barWidth/2;this.rootG.select("g.crosshair.horizontal line").attr("y1",e+.5).attr("y2",e+.5),this.rootG.select("g.crosshair.vertical line").attr("x1",s).attr("x2",s);const r=this.tqchart.mainSeries;if(r&&r.last_id>-1&&r.data&&this.tqchart.range.leftId>-1){const t=this.tqchart.range.leftId+i,n=r.data[t],a=r.data[t-1];if(!n)return;this._updateKlinePanel(s,n,a),this._updateXAxisannotation(s,n.datetime);const o=this.tqchart.getBoardByYPosition(e);o&&this._updateYAxisannotation(e,o)}}_updateKlinePanel(e,i,s){const r=[t("%Y-%m-%d (%w)")(i.datetime/1e6),t("%H:%M:%S")(i.datetime/1e6),"开盘",re(i.open,this.tqchart.price_decs),"最高",re(i.high,this.tqchart.price_decs),"最低",re(i.low,this.tqchart.price_decs),"收盘",re(i.close,this.tqchart.price_decs),"成交量",i.volume,"持仓量",i.close_oi];let n=null;s&&s.close&&(n=re(i.close-s.close,this.tqchart.price_decs),r.push("涨跌"),r.push(n),r.push("涨跌幅"),r.push(re(n/s.close*100,2)+"%"));const a=this.klinePanel.select("text").selectAll("tspan").data(r);a.enter().append("tspan").merge(a).attr("x",(t,e)=>e>1&&e%2==1?this.klinePanelWidth-1:1).attr("dy",(t,e)=>e>1&&e%2==1?"0px":"14px").attr("text-anchor",(t,e)=>e>1&&e%2==1?"end":"start").attr("class",(t,e)=>{if(15===e||17===e){if(n>0)return"up";if(n<0)return"down"}return""}).text(t=>t).exit().remove();let o=2;e<this.klinePanelWidth-this.tqchart.margin.left&&(o=this.tqchart.outerWidth-2-this.klinePanelWidth),this.klinePanel.attr("transform","translate("+o+",0)")}_updateXAxisannotation(e,i){this.rootG.select("g.axisannotation.x rect").attr("x",e-40),this.rootG.select("g.axisannotation.x text").text(t("%Y-%m-%d %H:%M:%S")(i/1e6)).attr("x",e-38)}_updateYAxisannotation(t,e){for(const i of["left","right"]){const s=e[i+"YAxis"],r=["g","axisannotation","y",i].join(".");if(s){const n=re(s.yScale.invert(t-e.top),"main"===e.boardId&&"right"===i&&this.tqchart.price_decs?this.tqchart.price_decs:0);if(!Number.isNaN(n)){this.rootG.select(r).attr("visibility","visible"),this.rootG.select(r+" rect").attr("y",t-10),this.rootG.select(r+" text").text(n).attr("y",t+2);continue}}this.rootG.select("g.axisannotation.y.left").attr("visibility","hidden")}}show(){this.svgG.attr("visibility","visible")}hide(){this.svgG.attr("visibility","hidden"),this.rootG.selectAll("g.axisannotation.y").attr("visibility","hidden")}drag(t){t?this.rectG.attr("class","crosshair-cursor drag"):this.rectG.attr("class","crosshair-cursor")}}class ae{constructor(t,i){this.board=t,this.align=i,this.yScale=e().range([this.board.height,0]),this.yAxis="left"===i?l():d(),this.yAxis.scale(this.yScale),this._init()}_init(){this.rootG=this.board.rootG.append("g").attr("class","y axis "+this.align),this.resetPosition()}resetPosition(){this.yScale.range([this.board.height,0]),"right"===this.align&&this.rootG.attr("transform","translate("+this.board.width+",0)")}getTicks(){const t=[],e=this;return this.rootG.selectAll(".tick").each((function(i){t.push(Math.round(e.yScale(i)))})),t}draw(t){this.yScale.domain(t),this.yAxis.ticks("main"===this.board.boardId?6:3),this.rootG.call(this.yAxis)}}class oe{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",s=arguments.length>3?arguments[3]:void 0;this.tqchart=t,this.parentSvg=e,this.board=s,this.rootG=this.parentSvg.append("g").attr("class","background"),this.direction=i,"horizontal"===this.direction&&this.rootG.append("line").attr("class","border").attr("x1",-this.tqchart.margin.left).attr("y1",-.5).attr("x2",this.tqchart.innerWidth+this.tqchart.margin.right).attr("y2",-.5)}clear(){this.rootG.selectAll("line").remove()}draw(){if("vertical"===this.direction){const t=this.tqchart.xAxis.getTicks();this._drawVerticalLines(t)}else if("horizontal"===this.direction){const t=this.board.rightYAxis.getTicks();this._drawHorizontalLines(t)}}resize(){"vertical"===this.direction?this.rootG.selectAll("line").attr("y2",this.tqchart.innerHeight):"horizontal"===this.direction&&this.rootG.selectAll("line").attr("x2",this.tqchart.innerWidth)}_drawVerticalLines(t){const e=this.tqchart.innerHeight,i=this.rootG.selectAll("line.bgline").data(t);i.enter().append("line").attr("class","bgline").attr("y1",0).attr("y2",e).merge(i).attr("x1",t=>t).attr("x2",t=>t),i.exit().remove()}_drawHorizontalLines(t){const e=this.tqchart.innerWidth,i=this.rootG.selectAll("line.bgline").data(t);i.enter().append("line").attr("class","bgline").attr("x1",0).attr("x2",e).merge(i).attr("y1",t=>t+.5).attr("y2",t=>t+.5),i.exit().remove()}}const he=2;class le{constructor(t,e,i,s,r){this.tqchart=t,this.boardId=e,this.top=i,this.height=s,this.width=this.tqchart.innerWidth,this.rootG=this.tqchart.rootG.append("g").attr("class",this.boardId).attr("transform","translate(0,"+this.top+")"),this.background=new oe(this.tqchart,this.rootG,"horizontal",this),this.plotG=this.rootG.append("g").attr("class",this.boardId+" plots"),this.maskG=this.rootG.append("mask").attr("id","mask-"+this.boardId).append("rect").attr("x","0").attr("y","0").attr("width",this.width).attr("height",this.height).style("fill","#FFFFFF").attr("stroke","none"),this.markG=this.rootG.append("g").attr("mask","url(#mask-"+this.boardId+")").attr("class",this.boardId+" marks"),this.nameG=this.markG.append("text").attr("class",this.boardId+" name text").attr("dy","12").attr("dx","2").text(this.boardId.toUpperCase()),this.leftYAxis=new ae(this,"left"),this.rightYAxis=new ae(this,"right")}resetPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.top,i=void 0===e?this.top:e,s=t.height,r=void 0===s?this.height:s;this.top=i,this.rootG.attr("transform","translate(0,"+this.top+")"),this.height=r,this.width=this.tqchart.innerWidth,this.maskG.attr("width",this.width).attr("height",this.height),this.background.resize(),this.leftYAxis&&this.leftYAxis.resetPosition(),this.rightYAxis.resetPosition()}setDomain(t){this[(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right")+"Domain"]=t}draw(t,e,i){this.leftYAxis.draw(this.leftDomain),this.rightYAxis.draw(this.rightDomain),this.background.draw()}remove(){this.rootG.remove()}static GetMutilPlotsHeight(t,e){const i=e-he*(t-1),s=1/t,r=Math.ceil(i*s*.7),n=[{top:0,height:i-r*(t-1)}];for(let e=1;e<t;e++)n[e]={height:r,top:n[e-1].top+n[e-1].height+he};return n}}var de,ce,ue=D("match"),fe=D("species"),me=function(t){return function(e,i){var s,r,n=String(z(e)),a=at(i),o=n.length;return a<0||a>=o?t?"":void 0:(s=n.charCodeAt(a))<55296||s>56319||a+1===o||(r=n.charCodeAt(a+1))<56320||r>57343?t?n.charAt(a):s:t?n.slice(a,a+2):r-56320+(s-55296<<10)+65536}}(!0),ge=function(t,e,i){return e+(i?me(t,e).length:1)},pe=D("toStringTag"),ye="Arguments"==V(function(){return arguments}()),_e=RegExp.prototype.exec,ve=function(t,e){var i,s,r,n,a=t.exec;if("function"==typeof a){var o=a.call(t,e);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==(void 0===(i=t)?"Undefined":null===i?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(s=Object(i),pe))?r:ye?V(s):"Object"==(n=V(s))&&"function"==typeof s.callee?"Arguments":n))throw new TypeError("RegExp#exec called on incompatible receiver");return _e.call(t,e)},be=function(){var t=Y(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},xe=RegExp.prototype.exec,we=String.prototype.replace,ke=xe,Se=(de=/a/,ce=/b*/g,xe.call(de,"a"),xe.call(ce,"a"),0!==de.lastIndex||0!==ce.lastIndex),Me=void 0!==/()??/.exec("")[1];(Se||Me)&&(ke=function(t){var e,i,s,r,n=this;return Me&&(i=new RegExp("^"+n.source+"$(?!\\s)",be.call(n))),Se&&(e=n.lastIndex),s=xe.call(n,t),Se&&s&&(n.lastIndex=n.global?s.index+s[0].length:e),Me&&s&&s.length>1&&we.call(s[0],i,(function(){for(r=1;r<arguments.length-2;r++)void 0===arguments[r]&&(s[r]=void 0)})),s});var De=ke;st({target:"RegExp",proto:!0,forced:De!==/./.exec},{exec:De});var Pe=D("species"),Ye=!T((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),Te=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var i="ab".split(t);return 2===i.length&&"a"===i[0]&&"b"===i[1]}(),Oe=function(t,e,i){var s=D(t),r=!T((function(){var e={};return e[s]=function(){return 7},7!=""[t](e)})),n=r?!T((function(){var e=!1,i=/a/;return i.exec=function(){return e=!0,null},"split"===t&&(i.constructor={},i.constructor[Pe]=function(){return i}),i[s](""),!e})):void 0;if(!r||!n||"replace"===t&&!Ye||"split"===t&&!Te){var a=/./[s],o=i(z,s,""[t],(function(t,e,i,s,n){return e.exec===De?r&&!n?{done:!0,value:a.call(e,i,s)}:{done:!0,value:t.call(i,e,s)}:{done:!1}})),h=o[0],l=o[1];X(String.prototype,t,h),L(RegExp.prototype,s,2==e?function(t,e){return l.call(t,this,e)}:function(t){return l.call(t,this)})}},Ie=Math.min,Ae=[].push,We=!T((function(){RegExp(4294967295,"y")}));Oe("split",2,(function(t,e,i,s){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,e){var s,r,n=String(this);if(void 0===t&&0===e)return[];if(!P(s=t)||(void 0!==(r=s[ue])?!r:"RegExp"!=V(s)))return i.call(n,t,e);for(var a,o,h,l=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),c=0,u=void 0===e?4294967295:e>>>0,f=new RegExp(t.source,d+"g");(a=De.call(f,n))&&!((o=f.lastIndex)>c&&(l.push(n.slice(c,a.index)),a.length>1&&a.index<n.length&&Ae.apply(l,a.slice(1)),h=a[0].length,c=o,l.length>=u));)f.lastIndex===a.index&&f.lastIndex++;return c===n.length?!h&&f.test("")||l.push(""):l.push(n.slice(c)),l.length>u?l.slice(0,u):l}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:i.call(this,t,e)}:i,[function(i,s){var n=t(this),a=null==i?void 0:i[e];return void 0!==a?a.call(i,n,s):r.call(String(n),i,s)},function(t,e){var n=s(r,t,this,e,r!==i);if(n.done)return n.value;var a=Y(t),o=String(this),h=function(t,e){var i,s=Y(t).constructor;return void 0===s||null==(i=Y(s)[fe])?e:Q(i)}(a,RegExp),l=a.unicode,d=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(We?"y":"g"),c=new h(We?a:"^(?:"+a.source+")",d),u=void 0===e?4294967295:e>>>0;if(0===u)return[];if(0===o.length)return null===ve(c,o)?[o]:[];for(var f=0,m=0,g=[];m<o.length;){c.lastIndex=We?m:0;var p,y=ve(c,We?o:o.slice(m));if(null===y||(p=Ie(ht(c.lastIndex+(We?0:m)),o.length))===f)m=ge(o,m,l);else{if(g.push(o.slice(f,m)),g.length===u)return g;for(var _=1;_<=y.length-1;_++)if(g.push(y[_]),g.length===u)return g;m=f=p}}return g.push(o.slice(f)),g}]}));var Ne=Math.max,Ge=Math.min,Ce=Math.floor,He=/\$([$&`']|\d\d?|<[^>]*>)/g,Le=/\$([$&`']|\d\d?)/g;Oe("replace",2,(function(t,e,i,s){return[function(s,r){var n=t(this),a=null==s?void 0:s[e];return void 0!==a?a.call(s,n,r):i.call(String(n),s,r)},function(t,e){var n=s(i,t,this,e);if(n.done)return n.value;var a=Y(t),o=String(this),h="function"==typeof e;h||(e=String(e));var l=a.global;if(l){var d=a.unicode;a.lastIndex=0}for(var c=[];;){var u=ve(a,o);if(null===u)break;if(c.push(u),!l)break;""===String(u[0])&&(a.lastIndex=ge(o,ht(a.lastIndex),d))}for(var f,m="",g=0,p=0;p<c.length;p++){u=c[p];for(var y=String(u[0]),_=Ne(Ge(at(u.index),o.length),0),v=[],b=1;b<u.length;b++)v.push(void 0===(f=u[b])?f:String(f));var x=u.groups;if(h){var w=[y].concat(v,_,o);void 0!==x&&w.push(x);var k=String(e.apply(void 0,w))}else k=r(y,o,_,v,x,e);_>=g&&(m+=o.slice(g,_)+k,g=_+y.length)}return m+o.slice(g)}];function r(t,e,s,r,n,a){var o=s+t.length,h=r.length,l=Le;return void 0!==n&&(n=Tt(n),l=He),i.call(a,l,(function(i,a){var l;switch(a.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,s);case"'":return e.slice(o);case"<":l=n[a.slice(1,-1)];break;default:var d=+a;if(0===d)return i;if(d>h){var c=Ce(d/10);return 0===c?i:c<=h?void 0===r[c-1]?a.charAt(1):r[c-1]+a.charAt(1):i}l=r[d-1]}return void 0===l?"":l}))}})),O&&"g"!=/./g.flags&&C.f(RegExp.prototype,"flags",{configurable:!0,get:be});var Fe=/./.toString,Re=function(t){X(RegExp.prototype,"toString",t,!0)};T((function(){return"/a/b"!=Fe.call({source:"a",flags:"b"})}))?Re((function(){var t=Y(this);return"/".concat(t.source,"/","flags"in t?t.flags:!O&&t instanceof RegExp?be.call(t):void 0)})):"toString"!=Fe.name&&Re((function(){return Fe.call(this)}));var qe=v((function(t,e){t.exports=function(){var e,i;function s(){return e.apply(null,arguments)}function r(t){return t instanceof Array||"[object Array]"===Object.prototype.toString.call(t)}function n(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function a(t){return void 0===t}function o(t){return"number"==typeof t||"[object Number]"===Object.prototype.toString.call(t)}function h(t){return t instanceof Date||"[object Date]"===Object.prototype.toString.call(t)}function l(t,e){var i,s=[];for(i=0;i<t.length;++i)s.push(e(t[i],i));return s}function d(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function c(t,e){for(var i in e)d(e,i)&&(t[i]=e[i]);return d(e,"toString")&&(t.toString=e.toString),d(e,"valueOf")&&(t.valueOf=e.valueOf),t}function u(t,e,i,s){return We(t,e,i,s,!0).utc()}function f(t){return null==t._pf&&(t._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),t._pf}function m(t){if(null==t._isValid){var e=f(t),s=i.call(e.parsedDateParts,(function(t){return null!=t})),r=!isNaN(t._d.getTime())&&e.overflow<0&&!e.empty&&!e.invalidMonth&&!e.invalidWeekday&&!e.weekdayMismatch&&!e.nullInput&&!e.invalidFormat&&!e.userInvalidated&&(!e.meridiem||e.meridiem&&s);if(t._strict&&(r=r&&0===e.charsLeftOver&&0===e.unusedTokens.length&&void 0===e.bigHour),null!=Object.isFrozen&&Object.isFrozen(t))return r;t._isValid=r}return t._isValid}function g(t){var e=u(NaN);return null!=t?c(f(e),t):f(e).userInvalidated=!0,e}i=Array.prototype.some?Array.prototype.some:function(t){for(var e=Object(this),i=e.length>>>0,s=0;s<i;s++)if(s in e&&t.call(this,e[s],s,e))return!0;return!1};var p=s.momentProperties=[];function y(t,e){var i,s,r;if(a(e._isAMomentObject)||(t._isAMomentObject=e._isAMomentObject),a(e._i)||(t._i=e._i),a(e._f)||(t._f=e._f),a(e._l)||(t._l=e._l),a(e._strict)||(t._strict=e._strict),a(e._tzm)||(t._tzm=e._tzm),a(e._isUTC)||(t._isUTC=e._isUTC),a(e._offset)||(t._offset=e._offset),a(e._pf)||(t._pf=f(e)),a(e._locale)||(t._locale=e._locale),p.length>0)for(i=0;i<p.length;i++)a(r=e[s=p[i]])||(t[s]=r);return t}var v=!1;function b(t){y(this,t),this._d=new Date(null!=t._d?t._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===v&&(v=!0,s.updateOffset(this),v=!1)}function x(t){return t instanceof b||null!=t&&null!=t._isAMomentObject}function w(t){return t<0?Math.ceil(t)||0:Math.floor(t)}function k(t){var e=+t,i=0;return 0!==e&&isFinite(e)&&(i=w(e)),i}function S(t,e,i){var s,r=Math.min(t.length,e.length),n=Math.abs(t.length-e.length),a=0;for(s=0;s<r;s++)(i&&t[s]!==e[s]||!i&&k(t[s])!==k(e[s]))&&a++;return a+n}function M(t){!1===s.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function D(t,e){var i=!0;return c((function(){if(null!=s.deprecationHandler&&s.deprecationHandler(null,t),i){for(var r,n=[],a=0;a<arguments.length;a++){if(r="","object"==typeof arguments[a]){for(var o in r+="\n["+a+"] ",arguments[0])r+=o+": "+arguments[0][o]+", ";r=r.slice(0,-2)}else r=arguments[a];n.push(r)}M(t+"\nArguments: "+Array.prototype.slice.call(n).join("")+"\n"+(new Error).stack),i=!1}return e.apply(this,arguments)}),e)}var P,Y={};function T(t,e){null!=s.deprecationHandler&&s.deprecationHandler(t,e),Y[t]||(M(e),Y[t]=!0)}function O(t){return t instanceof Function||"[object Function]"===Object.prototype.toString.call(t)}function I(t,e){var i,s=c({},t);for(i in e)d(e,i)&&(n(t[i])&&n(e[i])?(s[i]={},c(s[i],t[i]),c(s[i],e[i])):null!=e[i]?s[i]=e[i]:delete s[i]);for(i in t)d(t,i)&&!d(e,i)&&n(t[i])&&(s[i]=c({},s[i]));return s}function A(t){null!=t&&this.set(t)}s.suppressDeprecationWarnings=!1,s.deprecationHandler=null,P=Object.keys?Object.keys:function(t){var e,i=[];for(e in t)d(t,e)&&i.push(e);return i};var W={};function N(t,e){var i=t.toLowerCase();W[i]=W[i+"s"]=W[e]=t}function G(t){return"string"==typeof t?W[t]||W[t.toLowerCase()]:void 0}function C(t){var e,i,s={};for(i in t)d(t,i)&&(e=G(i))&&(s[e]=t[i]);return s}var H={};function L(t,e){H[t]=e}function F(t,e,i){var s=""+Math.abs(t),r=e-s.length;return(t>=0?i?"+":"":"-")+Math.pow(10,Math.max(0,r)).toString().substr(1)+s}var R=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,q=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,E={},$={};function j(t,e,i,s){var r=s;"string"==typeof s&&(r=function(){return this[s]()}),t&&($[t]=r),e&&($[e[0]]=function(){return F(r.apply(this,arguments),e[1],e[2])}),i&&($[i]=function(){return this.localeData().ordinal(r.apply(this,arguments),t)})}function V(t,e){return t.isValid()?(e=U(e,t.localeData()),E[e]=E[e]||function(t){var e,i,s,r=t.match(R);for(e=0,i=r.length;e<i;e++)$[r[e]]?r[e]=$[r[e]]:r[e]=(s=r[e]).match(/\[[\s\S]/)?s.replace(/^\[|\]$/g,""):s.replace(/\\/g,"");return function(e){var s,n="";for(s=0;s<i;s++)n+=O(r[s])?r[s].call(e,t):r[s];return n}}(e),E[e](t)):t.localeData().invalidDate()}function U(t,e){var i=5;function s(t){return e.longDateFormat(t)||t}for(q.lastIndex=0;i>=0&&q.test(t);)t=t.replace(q,s),q.lastIndex=0,i-=1;return t}var z=/\d/,B=/\d\d/,Z=/\d{3}/,K=/\d{4}/,J=/[+-]?\d{6}/,X=/\d\d?/,Q=/\d\d\d\d?/,tt=/\d\d\d\d\d\d?/,et=/\d{1,3}/,it=/\d{1,4}/,st=/[+-]?\d{1,6}/,rt=/\d+/,nt=/[+-]?\d+/,at=/Z|[+-]\d\d:?\d\d/gi,ot=/Z|[+-]\d\d(?::?\d\d)?/gi,ht=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,lt={};function dt(t,e,i){lt[t]=O(e)?e:function(t,s){return t&&i?i:e}}function ct(t,e){return d(lt,t)?lt[t](e._strict,e._locale):new RegExp(ut(t.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(t,e,i,s,r){return e||i||s||r}))))}function ut(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var ft={};function mt(t,e){var i,s=e;for("string"==typeof t&&(t=[t]),o(e)&&(s=function(t,i){i[e]=k(t)}),i=0;i<t.length;i++)ft[t[i]]=s}function gt(t,e){mt(t,(function(t,i,s,r){s._w=s._w||{},e(t,s._w,s,r)}))}function pt(t,e,i){null!=e&&d(ft,t)&&ft[t](e,i._a,i,t)}var yt=0,_t=1,vt=2,bt=3,xt=4,wt=5,kt=6,St=7,Mt=8;function Dt(t){return Pt(t)?366:365}function Pt(t){return t%4==0&&t%100!=0||t%400==0}j("Y",0,0,(function(){var t=this.year();return t<=9999?""+t:"+"+t})),j(0,["YY",2],0,(function(){return this.year()%100})),j(0,["YYYY",4],0,"year"),j(0,["YYYYY",5],0,"year"),j(0,["YYYYYY",6,!0],0,"year"),N("year","y"),L("year",1),dt("Y",nt),dt("YY",X,B),dt("YYYY",it,K),dt("YYYYY",st,J),dt("YYYYYY",st,J),mt(["YYYYY","YYYYYY"],yt),mt("YYYY",(function(t,e){e[yt]=2===t.length?s.parseTwoDigitYear(t):k(t)})),mt("YY",(function(t,e){e[yt]=s.parseTwoDigitYear(t)})),mt("Y",(function(t,e){e[yt]=parseInt(t,10)})),s.parseTwoDigitYear=function(t){return k(t)+(k(t)>68?1900:2e3)};var Yt,Tt=Ot("FullYear",!0);function Ot(t,e){return function(i){return null!=i?(At(this,t,i),s.updateOffset(this,e),this):It(this,t)}}function It(t,e){return t.isValid()?t._d["get"+(t._isUTC?"UTC":"")+e]():NaN}function At(t,e,i){t.isValid()&&!isNaN(i)&&("FullYear"===e&&Pt(t.year())&&1===t.month()&&29===t.date()?t._d["set"+(t._isUTC?"UTC":"")+e](i,t.month(),Wt(i,t.month())):t._d["set"+(t._isUTC?"UTC":"")+e](i))}function Wt(t,e){if(isNaN(t)||isNaN(e))return NaN;var i,s=(e%(i=12)+i)%i;return t+=(e-s)/12,1===s?Pt(t)?29:28:31-s%7%2}Yt=Array.prototype.indexOf?Array.prototype.indexOf:function(t){var e;for(e=0;e<this.length;++e)if(this[e]===t)return e;return-1},j("M",["MM",2],"Mo",(function(){return this.month()+1})),j("MMM",0,0,(function(t){return this.localeData().monthsShort(this,t)})),j("MMMM",0,0,(function(t){return this.localeData().months(this,t)})),N("month","M"),L("month",8),dt("M",X),dt("MM",X,B),dt("MMM",(function(t,e){return e.monthsShortRegex(t)})),dt("MMMM",(function(t,e){return e.monthsRegex(t)})),mt(["M","MM"],(function(t,e){e[_t]=k(t)-1})),mt(["MMM","MMMM"],(function(t,e,i,s){var r=i._locale.monthsParse(t,s,i._strict);null!=r?e[_t]=r:f(i).invalidMonth=t}));var Nt=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Gt="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Ct="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ht(t,e,i){var s,r,n,a=t.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)n=u([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(n,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(n,"").toLocaleLowerCase();return i?"MMM"===e?-1!==(r=Yt.call(this._shortMonthsParse,a))?r:null:-1!==(r=Yt.call(this._longMonthsParse,a))?r:null:"MMM"===e?-1!==(r=Yt.call(this._shortMonthsParse,a))?r:-1!==(r=Yt.call(this._longMonthsParse,a))?r:null:-1!==(r=Yt.call(this._longMonthsParse,a))?r:-1!==(r=Yt.call(this._shortMonthsParse,a))?r:null}function Lt(t,e){var i;if(!t.isValid())return t;if("string"==typeof e)if(/^\d+$/.test(e))e=k(e);else if(!o(e=t.localeData().monthsParse(e)))return t;return i=Math.min(t.date(),Wt(t.year(),e)),t._d["set"+(t._isUTC?"UTC":"")+"Month"](e,i),t}function Ft(t){return null!=t?(Lt(this,t),s.updateOffset(this,!0),this):It(this,"Month")}var Rt=ht,qt=ht;function Et(){function t(t,e){return e.length-t.length}var e,i,s=[],r=[],n=[];for(e=0;e<12;e++)i=u([2e3,e]),s.push(this.monthsShort(i,"")),r.push(this.months(i,"")),n.push(this.months(i,"")),n.push(this.monthsShort(i,""));for(s.sort(t),r.sort(t),n.sort(t),e=0;e<12;e++)s[e]=ut(s[e]),r[e]=ut(r[e]);for(e=0;e<24;e++)n[e]=ut(n[e]);this._monthsRegex=new RegExp("^("+n.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function $t(t,e,i,s,r,n,a){var o;return t<100&&t>=0?(o=new Date(t+400,e,i,s,r,n,a),isFinite(o.getFullYear())&&o.setFullYear(t)):o=new Date(t,e,i,s,r,n,a),o}function jt(t){var e;if(t<100&&t>=0){var i=Array.prototype.slice.call(arguments);i[0]=t+400,e=new Date(Date.UTC.apply(null,i)),isFinite(e.getUTCFullYear())&&e.setUTCFullYear(t)}else e=new Date(Date.UTC.apply(null,arguments));return e}function Vt(t,e,i){var s=7+e-i;return-(7+jt(t,0,s).getUTCDay()-e)%7+s-1}function Ut(t,e,i,s,r){var n,a,o=1+7*(e-1)+(7+i-s)%7+Vt(t,s,r);return o<=0?a=Dt(n=t-1)+o:o>Dt(t)?(n=t+1,a=o-Dt(t)):(n=t,a=o),{year:n,dayOfYear:a}}function zt(t,e,i){var s,r,n=Vt(t.year(),e,i),a=Math.floor((t.dayOfYear()-n-1)/7)+1;return a<1?s=a+Bt(r=t.year()-1,e,i):a>Bt(t.year(),e,i)?(s=a-Bt(t.year(),e,i),r=t.year()+1):(r=t.year(),s=a),{week:s,year:r}}function Bt(t,e,i){var s=Vt(t,e,i),r=Vt(t+1,e,i);return(Dt(t)-s+r)/7}function Zt(t,e){return t.slice(e,7).concat(t.slice(0,e))}j("w",["ww",2],"wo","week"),j("W",["WW",2],"Wo","isoWeek"),N("week","w"),N("isoWeek","W"),L("week",5),L("isoWeek",5),dt("w",X),dt("ww",X,B),dt("W",X),dt("WW",X,B),gt(["w","ww","W","WW"],(function(t,e,i,s){e[s.substr(0,1)]=k(t)})),j("d",0,"do","day"),j("dd",0,0,(function(t){return this.localeData().weekdaysMin(this,t)})),j("ddd",0,0,(function(t){return this.localeData().weekdaysShort(this,t)})),j("dddd",0,0,(function(t){return this.localeData().weekdays(this,t)})),j("e",0,0,"weekday"),j("E",0,0,"isoWeekday"),N("day","d"),N("weekday","e"),N("isoWeekday","E"),L("day",11),L("weekday",11),L("isoWeekday",11),dt("d",X),dt("e",X),dt("E",X),dt("dd",(function(t,e){return e.weekdaysMinRegex(t)})),dt("ddd",(function(t,e){return e.weekdaysShortRegex(t)})),dt("dddd",(function(t,e){return e.weekdaysRegex(t)})),gt(["dd","ddd","dddd"],(function(t,e,i,s){var r=i._locale.weekdaysParse(t,s,i._strict);null!=r?e.d=r:f(i).invalidWeekday=t})),gt(["d","e","E"],(function(t,e,i,s){e[s]=k(t)}));var Kt="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Jt="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Xt="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function Qt(t,e,i){var s,r,n,a=t.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)n=u([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(n,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(n,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(n,"").toLocaleLowerCase();return i?"dddd"===e?-1!==(r=Yt.call(this._weekdaysParse,a))?r:null:"ddd"===e?-1!==(r=Yt.call(this._shortWeekdaysParse,a))?r:null:-1!==(r=Yt.call(this._minWeekdaysParse,a))?r:null:"dddd"===e?-1!==(r=Yt.call(this._weekdaysParse,a))?r:-1!==(r=Yt.call(this._shortWeekdaysParse,a))?r:-1!==(r=Yt.call(this._minWeekdaysParse,a))?r:null:"ddd"===e?-1!==(r=Yt.call(this._shortWeekdaysParse,a))?r:-1!==(r=Yt.call(this._weekdaysParse,a))?r:-1!==(r=Yt.call(this._minWeekdaysParse,a))?r:null:-1!==(r=Yt.call(this._minWeekdaysParse,a))?r:-1!==(r=Yt.call(this._weekdaysParse,a))?r:-1!==(r=Yt.call(this._shortWeekdaysParse,a))?r:null}var te=ht,ee=ht,ie=ht;function se(){function t(t,e){return e.length-t.length}var e,i,s,r,n,a=[],o=[],h=[],l=[];for(e=0;e<7;e++)i=u([2e3,1]).day(e),s=this.weekdaysMin(i,""),r=this.weekdaysShort(i,""),n=this.weekdays(i,""),a.push(s),o.push(r),h.push(n),l.push(s),l.push(r),l.push(n);for(a.sort(t),o.sort(t),h.sort(t),l.sort(t),e=0;e<7;e++)o[e]=ut(o[e]),h[e]=ut(h[e]),l[e]=ut(l[e]);this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+h.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function re(){return this.hours()%12||12}function ne(t,e){j(t,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),e)}))}function ae(t,e){return e._meridiemParse}j("H",["HH",2],0,"hour"),j("h",["hh",2],0,re),j("k",["kk",2],0,(function(){return this.hours()||24})),j("hmm",0,0,(function(){return""+re.apply(this)+F(this.minutes(),2)})),j("hmmss",0,0,(function(){return""+re.apply(this)+F(this.minutes(),2)+F(this.seconds(),2)})),j("Hmm",0,0,(function(){return""+this.hours()+F(this.minutes(),2)})),j("Hmmss",0,0,(function(){return""+this.hours()+F(this.minutes(),2)+F(this.seconds(),2)})),ne("a",!0),ne("A",!1),N("hour","h"),L("hour",13),dt("a",ae),dt("A",ae),dt("H",X),dt("h",X),dt("k",X),dt("HH",X,B),dt("hh",X,B),dt("kk",X,B),dt("hmm",Q),dt("hmmss",tt),dt("Hmm",Q),dt("Hmmss",tt),mt(["H","HH"],bt),mt(["k","kk"],(function(t,e,i){var s=k(t);e[bt]=24===s?0:s})),mt(["a","A"],(function(t,e,i){i._isPm=i._locale.isPM(t),i._meridiem=t})),mt(["h","hh"],(function(t,e,i){e[bt]=k(t),f(i).bigHour=!0})),mt("hmm",(function(t,e,i){var s=t.length-2;e[bt]=k(t.substr(0,s)),e[xt]=k(t.substr(s)),f(i).bigHour=!0})),mt("hmmss",(function(t,e,i){var s=t.length-4,r=t.length-2;e[bt]=k(t.substr(0,s)),e[xt]=k(t.substr(s,2)),e[wt]=k(t.substr(r)),f(i).bigHour=!0})),mt("Hmm",(function(t,e,i){var s=t.length-2;e[bt]=k(t.substr(0,s)),e[xt]=k(t.substr(s))})),mt("Hmmss",(function(t,e,i){var s=t.length-4,r=t.length-2;e[bt]=k(t.substr(0,s)),e[xt]=k(t.substr(s,2)),e[wt]=k(t.substr(r))}));var oe,he=Ot("Hours",!0),le={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Gt,monthsShort:Ct,week:{dow:0,doy:6},weekdays:Kt,weekdaysMin:Xt,weekdaysShort:Jt,meridiemParse:/[ap]\.?m?\.?/i},de={},ce={};function ue(t){return t?t.toLowerCase().replace("_","-"):t}function fe(e){var i=null;if(!de[e]&&t&&t.exports)try{i=oe._abbr,_(),me(i)}catch(t){}return de[e]}function me(t,e){var i;return t&&((i=a(e)?pe(t):ge(t,e))?oe=i:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+t+" not found. Did you forget to load it?")),oe._abbr}function ge(t,e){if(null!==e){var i,s=le;if(e.abbr=t,null!=de[t])T("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=de[t]._config;else if(null!=e.parentLocale)if(null!=de[e.parentLocale])s=de[e.parentLocale]._config;else{if(null==(i=fe(e.parentLocale)))return ce[e.parentLocale]||(ce[e.parentLocale]=[]),ce[e.parentLocale].push({name:t,config:e}),null;s=i._config}return de[t]=new A(I(s,e)),ce[t]&&ce[t].forEach((function(t){ge(t.name,t.config)})),me(t),de[t]}return delete de[t],null}function pe(t){var e;if(t&&t._locale&&t._locale._abbr&&(t=t._locale._abbr),!t)return oe;if(!r(t)){if(e=fe(t))return e;t=[t]}return function(t){for(var e,i,s,r,n=0;n<t.length;){for(e=(r=ue(t[n]).split("-")).length,i=(i=ue(t[n+1]))?i.split("-"):null;e>0;){if(s=fe(r.slice(0,e).join("-")))return s;if(i&&i.length>=e&&S(r,i,!0)>=e-1)break;e--}n++}return oe}(t)}function ye(t){var e,i=t._a;return i&&-2===f(t).overflow&&(e=i[_t]<0||i[_t]>11?_t:i[vt]<1||i[vt]>Wt(i[yt],i[_t])?vt:i[bt]<0||i[bt]>24||24===i[bt]&&(0!==i[xt]||0!==i[wt]||0!==i[kt])?bt:i[xt]<0||i[xt]>59?xt:i[wt]<0||i[wt]>59?wt:i[kt]<0||i[kt]>999?kt:-1,f(t)._overflowDayOfYear&&(e<yt||e>vt)&&(e=vt),f(t)._overflowWeeks&&-1===e&&(e=St),f(t)._overflowWeekday&&-1===e&&(e=Mt),f(t).overflow=e),t}function _e(t,e,i){return null!=t?t:null!=e?e:i}function ve(t){var e,i,r,n,a,o=[];if(!t._d){for(r=function(t){var e=new Date(s.now());return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}(t),t._w&&null==t._a[vt]&&null==t._a[_t]&&function(t){var e,i,s,r,n,a,o,h;if(null!=(e=t._w).GG||null!=e.W||null!=e.E)n=1,a=4,i=_e(e.GG,t._a[yt],zt(Ne(),1,4).year),s=_e(e.W,1),((r=_e(e.E,1))<1||r>7)&&(h=!0);else{n=t._locale._week.dow,a=t._locale._week.doy;var l=zt(Ne(),n,a);i=_e(e.gg,t._a[yt],l.year),s=_e(e.w,l.week),null!=e.d?((r=e.d)<0||r>6)&&(h=!0):null!=e.e?(r=e.e+n,(e.e<0||e.e>6)&&(h=!0)):r=n}s<1||s>Bt(i,n,a)?f(t)._overflowWeeks=!0:null!=h?f(t)._overflowWeekday=!0:(o=Ut(i,s,r,n,a),t._a[yt]=o.year,t._dayOfYear=o.dayOfYear)}(t),null!=t._dayOfYear&&(a=_e(t._a[yt],r[yt]),(t._dayOfYear>Dt(a)||0===t._dayOfYear)&&(f(t)._overflowDayOfYear=!0),i=jt(a,0,t._dayOfYear),t._a[_t]=i.getUTCMonth(),t._a[vt]=i.getUTCDate()),e=0;e<3&&null==t._a[e];++e)t._a[e]=o[e]=r[e];for(;e<7;e++)t._a[e]=o[e]=null==t._a[e]?2===e?1:0:t._a[e];24===t._a[bt]&&0===t._a[xt]&&0===t._a[wt]&&0===t._a[kt]&&(t._nextDay=!0,t._a[bt]=0),t._d=(t._useUTC?jt:$t).apply(null,o),n=t._useUTC?t._d.getUTCDay():t._d.getDay(),null!=t._tzm&&t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),t._nextDay&&(t._a[bt]=24),t._w&&void 0!==t._w.d&&t._w.d!==n&&(f(t).weekdayMismatch=!0)}}var be=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,xe=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,we=/Z|[+-]\d\d(?::?\d\d)?/,ke=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Se=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Me=/^\/?Date\((\-?\d+)/i;function De(t){var e,i,s,r,n,a,o=t._i,h=be.exec(o)||xe.exec(o);if(h){for(f(t).iso=!0,e=0,i=ke.length;e<i;e++)if(ke[e][1].exec(h[1])){r=ke[e][0],s=!1!==ke[e][2];break}if(null==r)return void(t._isValid=!1);if(h[3]){for(e=0,i=Se.length;e<i;e++)if(Se[e][1].exec(h[3])){n=(h[2]||" ")+Se[e][0];break}if(null==n)return void(t._isValid=!1)}if(!s&&null!=n)return void(t._isValid=!1);if(h[4]){if(!we.exec(h[4]))return void(t._isValid=!1);a="Z"}t._f=r+(n||"")+(a||""),Ie(t)}else t._isValid=!1}var Pe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function Ye(t){var e=parseInt(t,10);return e<=49?2e3+e:e<=999?1900+e:e}var Te={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Oe(t){var e,i,s,r,n,a,o,h=Pe.exec(t._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(h){var l=(e=h[4],i=h[3],s=h[2],r=h[5],n=h[6],a=h[7],o=[Ye(e),Ct.indexOf(i),parseInt(s,10),parseInt(r,10),parseInt(n,10)],a&&o.push(parseInt(a,10)),o);if(!function(t,e,i){return!t||Jt.indexOf(t)===new Date(e[0],e[1],e[2]).getDay()||(f(i).weekdayMismatch=!0,i._isValid=!1,!1)}(h[1],l,t))return;t._a=l,t._tzm=function(t,e,i){if(t)return Te[t];if(e)return 0;var s=parseInt(i,10),r=s%100;return(s-r)/100*60+r}(h[8],h[9],h[10]),t._d=jt.apply(null,t._a),t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),f(t).rfc2822=!0}else t._isValid=!1}function Ie(t){if(t._f!==s.ISO_8601)if(t._f!==s.RFC_2822){t._a=[],f(t).empty=!0;var e,i,r,n,a,o=""+t._i,h=o.length,l=0;for(r=U(t._f,t._locale).match(R)||[],e=0;e<r.length;e++)n=r[e],(i=(o.match(ct(n,t))||[])[0])&&((a=o.substr(0,o.indexOf(i))).length>0&&f(t).unusedInput.push(a),o=o.slice(o.indexOf(i)+i.length),l+=i.length),$[n]?(i?f(t).empty=!1:f(t).unusedTokens.push(n),pt(n,i,t)):t._strict&&!i&&f(t).unusedTokens.push(n);f(t).charsLeftOver=h-l,o.length>0&&f(t).unusedInput.push(o),t._a[bt]<=12&&!0===f(t).bigHour&&t._a[bt]>0&&(f(t).bigHour=void 0),f(t).parsedDateParts=t._a.slice(0),f(t).meridiem=t._meridiem,t._a[bt]=function(t,e,i){var s;return null==i?e:null!=t.meridiemHour?t.meridiemHour(e,i):null!=t.isPM?((s=t.isPM(i))&&e<12&&(e+=12),s||12!==e||(e=0),e):e}(t._locale,t._a[bt],t._meridiem),ve(t),ye(t)}else Oe(t);else De(t)}function Ae(t){var e=t._i,i=t._f;return t._locale=t._locale||pe(t._l),null===e||void 0===i&&""===e?g({nullInput:!0}):("string"==typeof e&&(t._i=e=t._locale.preparse(e)),x(e)?new b(ye(e)):(h(e)?t._d=e:r(i)?function(t){var e,i,s,r,n;if(0===t._f.length)return f(t).invalidFormat=!0,void(t._d=new Date(NaN));for(r=0;r<t._f.length;r++)n=0,e=y({},t),null!=t._useUTC&&(e._useUTC=t._useUTC),e._f=t._f[r],Ie(e),m(e)&&(n+=f(e).charsLeftOver,n+=10*f(e).unusedTokens.length,f(e).score=n,(null==s||n<s)&&(s=n,i=e));c(t,i||e)}(t):i?Ie(t):function(t){var e=t._i;a(e)?t._d=new Date(s.now()):h(e)?t._d=new Date(e.valueOf()):"string"==typeof e?function(t){var e=Me.exec(t._i);null===e?(De(t),!1===t._isValid&&(delete t._isValid,Oe(t),!1===t._isValid&&(delete t._isValid,s.createFromInputFallback(t)))):t._d=new Date(+e[1])}(t):r(e)?(t._a=l(e.slice(0),(function(t){return parseInt(t,10)})),ve(t)):n(e)?function(t){if(!t._d){var e=C(t._i);t._a=l([e.year,e.month,e.day||e.date,e.hour,e.minute,e.second,e.millisecond],(function(t){return t&&parseInt(t,10)})),ve(t)}}(t):o(e)?t._d=new Date(e):s.createFromInputFallback(t)}(t),m(t)||(t._d=null),t))}function We(t,e,i,s,a){var o,h={};return!0!==i&&!1!==i||(s=i,i=void 0),(n(t)&&function(t){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(t).length;var e;for(e in t)if(t.hasOwnProperty(e))return!1;return!0}(t)||r(t)&&0===t.length)&&(t=void 0),h._isAMomentObject=!0,h._useUTC=h._isUTC=a,h._l=i,h._i=t,h._f=e,h._strict=s,(o=new b(ye(Ae(h))))._nextDay&&(o.add(1,"d"),o._nextDay=void 0),o}function Ne(t,e,i,s){return We(t,e,i,s,!1)}s.createFromInputFallback=D("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(t){t._d=new Date(t._i+(t._useUTC?" UTC":""))})),s.ISO_8601=function(){},s.RFC_2822=function(){};var Ge=D("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var t=Ne.apply(null,arguments);return this.isValid()&&t.isValid()?t<this?this:t:g()})),Ce=D("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var t=Ne.apply(null,arguments);return this.isValid()&&t.isValid()?t>this?this:t:g()}));function He(t,e){var i,s;if(1===e.length&&r(e[0])&&(e=e[0]),!e.length)return Ne();for(i=e[0],s=1;s<e.length;++s)e[s].isValid()&&!e[s][t](i)||(i=e[s]);return i}var Le=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Fe(t){var e=C(t),i=e.year||0,s=e.quarter||0,r=e.month||0,n=e.week||e.isoWeek||0,a=e.day||0,o=e.hour||0,h=e.minute||0,l=e.second||0,d=e.millisecond||0;this._isValid=function(t){for(var e in t)if(-1===Yt.call(Le,e)||null!=t[e]&&isNaN(t[e]))return!1;for(var i=!1,s=0;s<Le.length;++s)if(t[Le[s]]){if(i)return!1;parseFloat(t[Le[s]])!==k(t[Le[s]])&&(i=!0)}return!0}(e),this._milliseconds=+d+1e3*l+6e4*h+1e3*o*60*60,this._days=+a+7*n,this._months=+r+3*s+12*i,this._data={},this._locale=pe(),this._bubble()}function Re(t){return t instanceof Fe}function qe(t){return t<0?-1*Math.round(-1*t):Math.round(t)}function Ee(t,e){j(t,0,0,(function(){var t=this.utcOffset(),i="+";return t<0&&(t=-t,i="-"),i+F(~~(t/60),2)+e+F(~~t%60,2)}))}Ee("Z",":"),Ee("ZZ",""),dt("Z",ot),dt("ZZ",ot),mt(["Z","ZZ"],(function(t,e,i){i._useUTC=!0,i._tzm=je(ot,t)}));var $e=/([\+\-]|\d\d)/gi;function je(t,e){var i=(e||"").match(t);if(null===i)return null;var s=((i[i.length-1]||[])+"").match($e)||["-",0,0],r=60*s[1]+k(s[2]);return 0===r?0:"+"===s[0]?r:-r}function Ve(t,e){var i,r;return e._isUTC?(i=e.clone(),r=(x(t)||h(t)?t.valueOf():Ne(t).valueOf())-i.valueOf(),i._d.setTime(i._d.valueOf()+r),s.updateOffset(i,!1),i):Ne(t).local()}function Ue(t){return 15*-Math.round(t._d.getTimezoneOffset()/15)}function ze(){return!!this.isValid()&&this._isUTC&&0===this._offset}s.updateOffset=function(){};var Be=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Ze=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Ke(t,e){var i,s,r,n,a,h,l=t,c=null;return Re(t)?l={ms:t._milliseconds,d:t._days,M:t._months}:o(t)?(l={},e?l[e]=t:l.milliseconds=t):(c=Be.exec(t))?(i="-"===c[1]?-1:1,l={y:0,d:k(c[vt])*i,h:k(c[bt])*i,m:k(c[xt])*i,s:k(c[wt])*i,ms:k(qe(1e3*c[kt]))*i}):(c=Ze.exec(t))?(i="-"===c[1]?-1:1,l={y:Je(c[2],i),M:Je(c[3],i),w:Je(c[4],i),d:Je(c[5],i),h:Je(c[6],i),m:Je(c[7],i),s:Je(c[8],i)}):null==l?l={}:"object"==typeof l&&("from"in l||"to"in l)&&(n=Ne(l.from),a=Ne(l.to),r=n.isValid()&&a.isValid()?(a=Ve(a,n),n.isBefore(a)?h=Xe(n,a):((h=Xe(a,n)).milliseconds=-h.milliseconds,h.months=-h.months),h):{milliseconds:0,months:0},(l={}).ms=r.milliseconds,l.M=r.months),s=new Fe(l),Re(t)&&d(t,"_locale")&&(s._locale=t._locale),s}function Je(t,e){var i=t&&parseFloat(t.replace(",","."));return(isNaN(i)?0:i)*e}function Xe(t,e){var i={};return i.months=e.month()-t.month()+12*(e.year()-t.year()),t.clone().add(i.months,"M").isAfter(e)&&--i.months,i.milliseconds=+e-+t.clone().add(i.months,"M"),i}function Qe(t,e){return function(i,s){var r;return null===s||isNaN(+s)||(T(e,"moment()."+e+"(period, number) is deprecated. Please use moment()."+e+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),r=i,i=s,s=r),ti(this,Ke(i="string"==typeof i?+i:i,s),t),this}}function ti(t,e,i,r){var n=e._milliseconds,a=qe(e._days),o=qe(e._months);t.isValid()&&(r=null==r||r,o&&Lt(t,It(t,"Month")+o*i),a&&At(t,"Date",It(t,"Date")+a*i),n&&t._d.setTime(t._d.valueOf()+n*i),r&&s.updateOffset(t,a||o))}Ke.fn=Fe.prototype,Ke.invalid=function(){return Ke(NaN)};var ei=Qe(1,"add"),ii=Qe(-1,"subtract");function si(t,e){var i=12*(e.year()-t.year())+(e.month()-t.month()),s=t.clone().add(i,"months");return-(i+(e-s<0?(e-s)/(s-t.clone().add(i-1,"months")):(e-s)/(t.clone().add(i+1,"months")-s)))||0}function ri(t){var e;return void 0===t?this._locale._abbr:(null!=(e=pe(t))&&(this._locale=e),this)}s.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",s.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var ni=D("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(t){return void 0===t?this.localeData():this.locale(t)}));function ai(){return this._locale}var oi=1e3,hi=60*oi,li=60*hi,di=3506328*li;function ci(t,e){return(t%e+e)%e}function ui(t,e,i){return t<100&&t>=0?new Date(t+400,e,i)-di:new Date(t,e,i).valueOf()}function fi(t,e,i){return t<100&&t>=0?Date.UTC(t+400,e,i)-di:Date.UTC(t,e,i)}function mi(t,e){j(0,[t,t.length],0,e)}function gi(t,e,i,s,r){var n;return null==t?zt(this,s,r).year:(e>(n=Bt(t,s,r))&&(e=n),pi.call(this,t,e,i,s,r))}function pi(t,e,i,s,r){var n=Ut(t,e,i,s,r),a=jt(n.year,0,n.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}j(0,["gg",2],0,(function(){return this.weekYear()%100})),j(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),mi("gggg","weekYear"),mi("ggggg","weekYear"),mi("GGGG","isoWeekYear"),mi("GGGGG","isoWeekYear"),N("weekYear","gg"),N("isoWeekYear","GG"),L("weekYear",1),L("isoWeekYear",1),dt("G",nt),dt("g",nt),dt("GG",X,B),dt("gg",X,B),dt("GGGG",it,K),dt("gggg",it,K),dt("GGGGG",st,J),dt("ggggg",st,J),gt(["gggg","ggggg","GGGG","GGGGG"],(function(t,e,i,s){e[s.substr(0,2)]=k(t)})),gt(["gg","GG"],(function(t,e,i,r){e[r]=s.parseTwoDigitYear(t)})),j("Q",0,"Qo","quarter"),N("quarter","Q"),L("quarter",7),dt("Q",z),mt("Q",(function(t,e){e[_t]=3*(k(t)-1)})),j("D",["DD",2],"Do","date"),N("date","D"),L("date",9),dt("D",X),dt("DD",X,B),dt("Do",(function(t,e){return t?e._dayOfMonthOrdinalParse||e._ordinalParse:e._dayOfMonthOrdinalParseLenient})),mt(["D","DD"],vt),mt("Do",(function(t,e){e[vt]=k(t.match(X)[0])}));var yi=Ot("Date",!0);j("DDD",["DDDD",3],"DDDo","dayOfYear"),N("dayOfYear","DDD"),L("dayOfYear",4),dt("DDD",et),dt("DDDD",Z),mt(["DDD","DDDD"],(function(t,e,i){i._dayOfYear=k(t)})),j("m",["mm",2],0,"minute"),N("minute","m"),L("minute",14),dt("m",X),dt("mm",X,B),mt(["m","mm"],xt);var _i=Ot("Minutes",!1);j("s",["ss",2],0,"second"),N("second","s"),L("second",15),dt("s",X),dt("ss",X,B),mt(["s","ss"],wt);var vi,bi=Ot("Seconds",!1);for(j("S",0,0,(function(){return~~(this.millisecond()/100)})),j(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),j(0,["SSS",3],0,"millisecond"),j(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),j(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),j(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),j(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),j(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),j(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),N("millisecond","ms"),L("millisecond",16),dt("S",et,z),dt("SS",et,B),dt("SSS",et,Z),vi="SSSS";vi.length<=9;vi+="S")dt(vi,rt);function xi(t,e){e[kt]=k(1e3*("0."+t))}for(vi="S";vi.length<=9;vi+="S")mt(vi,xi);var wi=Ot("Milliseconds",!1);j("z",0,0,"zoneAbbr"),j("zz",0,0,"zoneName");var ki=b.prototype;function Si(t){return t}ki.add=ei,ki.calendar=function(t,e){var i=t||Ne(),r=Ve(i,this).startOf("day"),n=s.calendarFormat(this,r)||"sameElse",a=e&&(O(e[n])?e[n].call(this,i):e[n]);return this.format(a||this.localeData().calendar(n,this,Ne(i)))},ki.clone=function(){return new b(this)},ki.diff=function(t,e,i){var s,r,n;if(!this.isValid())return NaN;if(!(s=Ve(t,this)).isValid())return NaN;switch(r=6e4*(s.utcOffset()-this.utcOffset()),e=G(e)){case"year":n=si(this,s)/12;break;case"month":n=si(this,s);break;case"quarter":n=si(this,s)/3;break;case"second":n=(this-s)/1e3;break;case"minute":n=(this-s)/6e4;break;case"hour":n=(this-s)/36e5;break;case"day":n=(this-s-r)/864e5;break;case"week":n=(this-s-r)/6048e5;break;default:n=this-s}return i?n:w(n)},ki.endOf=function(t){var e;if(void 0===(t=G(t))||"millisecond"===t||!this.isValid())return this;var i=this._isUTC?fi:ui;switch(t){case"year":e=i(this.year()+1,0,1)-1;break;case"quarter":e=i(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":e=i(this.year(),this.month()+1,1)-1;break;case"week":e=i(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":e=i(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":e=i(this.year(),this.month(),this.date()+1)-1;break;case"hour":e=this._d.valueOf(),e+=li-ci(e+(this._isUTC?0:this.utcOffset()*hi),li)-1;break;case"minute":e=this._d.valueOf(),e+=hi-ci(e,hi)-1;break;case"second":e=this._d.valueOf(),e+=oi-ci(e,oi)-1}return this._d.setTime(e),s.updateOffset(this,!0),this},ki.format=function(t){t||(t=this.isUtc()?s.defaultFormatUtc:s.defaultFormat);var e=V(this,t);return this.localeData().postformat(e)},ki.from=function(t,e){return this.isValid()&&(x(t)&&t.isValid()||Ne(t).isValid())?Ke({to:this,from:t}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()},ki.fromNow=function(t){return this.from(Ne(),t)},ki.to=function(t,e){return this.isValid()&&(x(t)&&t.isValid()||Ne(t).isValid())?Ke({from:this,to:t}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()},ki.toNow=function(t){return this.to(Ne(),t)},ki.get=function(t){return O(this[t=G(t)])?this[t]():this},ki.invalidAt=function(){return f(this).overflow},ki.isAfter=function(t,e){var i=x(t)?t:Ne(t);return!(!this.isValid()||!i.isValid())&&("millisecond"===(e=G(e)||"millisecond")?this.valueOf()>i.valueOf():i.valueOf()<this.clone().startOf(e).valueOf())},ki.isBefore=function(t,e){var i=x(t)?t:Ne(t);return!(!this.isValid()||!i.isValid())&&("millisecond"===(e=G(e)||"millisecond")?this.valueOf()<i.valueOf():this.clone().endOf(e).valueOf()<i.valueOf())},ki.isBetween=function(t,e,i,s){var r=x(t)?t:Ne(t),n=x(e)?e:Ne(e);return!!(this.isValid()&&r.isValid()&&n.isValid())&&("("===(s=s||"()")[0]?this.isAfter(r,i):!this.isBefore(r,i))&&(")"===s[1]?this.isBefore(n,i):!this.isAfter(n,i))},ki.isSame=function(t,e){var i,s=x(t)?t:Ne(t);return!(!this.isValid()||!s.isValid())&&("millisecond"===(e=G(e)||"millisecond")?this.valueOf()===s.valueOf():(i=s.valueOf(),this.clone().startOf(e).valueOf()<=i&&i<=this.clone().endOf(e).valueOf()))},ki.isSameOrAfter=function(t,e){return this.isSame(t,e)||this.isAfter(t,e)},ki.isSameOrBefore=function(t,e){return this.isSame(t,e)||this.isBefore(t,e)},ki.isValid=function(){return m(this)},ki.lang=ni,ki.locale=ri,ki.localeData=ai,ki.max=Ce,ki.min=Ge,ki.parsingFlags=function(){return c({},f(this))},ki.set=function(t,e){if("object"==typeof t)for(var i=function(t){var e=[];for(var i in t)e.push({unit:i,priority:H[i]});return e.sort((function(t,e){return t.priority-e.priority})),e}(t=C(t)),s=0;s<i.length;s++)this[i[s].unit](t[i[s].unit]);else if(O(this[t=G(t)]))return this[t](e);return this},ki.startOf=function(t){var e;if(void 0===(t=G(t))||"millisecond"===t||!this.isValid())return this;var i=this._isUTC?fi:ui;switch(t){case"year":e=i(this.year(),0,1);break;case"quarter":e=i(this.year(),this.month()-this.month()%3,1);break;case"month":e=i(this.year(),this.month(),1);break;case"week":e=i(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":e=i(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":e=i(this.year(),this.month(),this.date());break;case"hour":e=this._d.valueOf(),e-=ci(e+(this._isUTC?0:this.utcOffset()*hi),li);break;case"minute":e=this._d.valueOf(),e-=ci(e,hi);break;case"second":e=this._d.valueOf(),e-=ci(e,oi)}return this._d.setTime(e),s.updateOffset(this,!0),this},ki.subtract=ii,ki.toArray=function(){var t=this;return[t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()]},ki.toObject=function(){var t=this;return{years:t.year(),months:t.month(),date:t.date(),hours:t.hours(),minutes:t.minutes(),seconds:t.seconds(),milliseconds:t.milliseconds()}},ki.toDate=function(){return new Date(this.valueOf())},ki.toISOString=function(t){if(!this.isValid())return null;var e=!0!==t,i=e?this.clone().utc():this;return i.year()<0||i.year()>9999?V(i,e?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):O(Date.prototype.toISOString)?e?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",V(i,"Z")):V(i,e?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},ki.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var t="moment",e="";this.isLocal()||(t=0===this.utcOffset()?"moment.utc":"moment.parseZone",e="Z");var i="["+t+'("]',s=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",r=e+'[")]';return this.format(i+s+"-MM-DD[T]HH:mm:ss.SSS"+r)},ki.toJSON=function(){return this.isValid()?this.toISOString():null},ki.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},ki.unix=function(){return Math.floor(this.valueOf()/1e3)},ki.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},ki.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},ki.year=Tt,ki.isLeapYear=function(){return Pt(this.year())},ki.weekYear=function(t){return gi.call(this,t,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},ki.isoWeekYear=function(t){return gi.call(this,t,this.isoWeek(),this.isoWeekday(),1,4)},ki.quarter=ki.quarters=function(t){return null==t?Math.ceil((this.month()+1)/3):this.month(3*(t-1)+this.month()%3)},ki.month=Ft,ki.daysInMonth=function(){return Wt(this.year(),this.month())},ki.week=ki.weeks=function(t){var e=this.localeData().week(this);return null==t?e:this.add(7*(t-e),"d")},ki.isoWeek=ki.isoWeeks=function(t){var e=zt(this,1,4).week;return null==t?e:this.add(7*(t-e),"d")},ki.weeksInYear=function(){var t=this.localeData()._week;return Bt(this.year(),t.dow,t.doy)},ki.isoWeeksInYear=function(){return Bt(this.year(),1,4)},ki.date=yi,ki.day=ki.days=function(t){if(!this.isValid())return null!=t?this:NaN;var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=function(t,e){return"string"!=typeof t?t:isNaN(t)?"number"==typeof(t=e.weekdaysParse(t))?t:null:parseInt(t,10)}(t,this.localeData()),this.add(t-e,"d")):e},ki.weekday=function(t){if(!this.isValid())return null!=t?this:NaN;var e=(this.day()+7-this.localeData()._week.dow)%7;return null==t?e:this.add(t-e,"d")},ki.isoWeekday=function(t){if(!this.isValid())return null!=t?this:NaN;if(null!=t){var e=function(t,e){return"string"==typeof t?e.weekdaysParse(t)%7||7:isNaN(t)?null:t}(t,this.localeData());return this.day(this.day()%7?e:e-7)}return this.day()||7},ki.dayOfYear=function(t){var e=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==t?e:this.add(t-e,"d")},ki.hour=ki.hours=he,ki.minute=ki.minutes=_i,ki.second=ki.seconds=bi,ki.millisecond=ki.milliseconds=wi,ki.utcOffset=function(t,e,i){var r,n=this._offset||0;if(!this.isValid())return null!=t?this:NaN;if(null!=t){if("string"==typeof t){if(null===(t=je(ot,t)))return this}else Math.abs(t)<16&&!i&&(t*=60);return!this._isUTC&&e&&(r=Ue(this)),this._offset=t,this._isUTC=!0,null!=r&&this.add(r,"m"),n!==t&&(!e||this._changeInProgress?ti(this,Ke(t-n,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,s.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?n:Ue(this)},ki.utc=function(t){return this.utcOffset(0,t)},ki.local=function(t){return this._isUTC&&(this.utcOffset(0,t),this._isUTC=!1,t&&this.subtract(Ue(this),"m")),this},ki.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var t=je(at,this._i);null!=t?this.utcOffset(t):this.utcOffset(0,!0)}return this},ki.hasAlignedHourOffset=function(t){return!!this.isValid()&&(t=t?Ne(t).utcOffset():0,(this.utcOffset()-t)%60==0)},ki.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},ki.isLocal=function(){return!!this.isValid()&&!this._isUTC},ki.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},ki.isUtc=ze,ki.isUTC=ze,ki.zoneAbbr=function(){return this._isUTC?"UTC":""},ki.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},ki.dates=D("dates accessor is deprecated. Use date instead.",yi),ki.months=D("months accessor is deprecated. Use month instead",Ft),ki.years=D("years accessor is deprecated. Use year instead",Tt),ki.zone=D("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",(function(t,e){return null!=t?("string"!=typeof t&&(t=-t),this.utcOffset(t,e),this):-this.utcOffset()})),ki.isDSTShifted=D("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",(function(){if(!a(this._isDSTShifted))return this._isDSTShifted;var t={};if(y(t,this),(t=Ae(t))._a){var e=t._isUTC?u(t._a):Ne(t._a);this._isDSTShifted=this.isValid()&&S(t._a,e.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}));var Mi=A.prototype;function Di(t,e,i,s){var r=pe(),n=u().set(s,e);return r[i](n,t)}function Pi(t,e,i){if(o(t)&&(e=t,t=void 0),t=t||"",null!=e)return Di(t,e,i,"month");var s,r=[];for(s=0;s<12;s++)r[s]=Di(t,s,i,"month");return r}function Yi(t,e,i,s){"boolean"==typeof t?(o(e)&&(i=e,e=void 0),e=e||""):(i=e=t,t=!1,o(e)&&(i=e,e=void 0),e=e||"");var r,n=pe(),a=t?n._week.dow:0;if(null!=i)return Di(e,(i+a)%7,s,"day");var h=[];for(r=0;r<7;r++)h[r]=Di(e,(r+a)%7,s,"day");return h}Mi.calendar=function(t,e,i){var s=this._calendar[t]||this._calendar.sameElse;return O(s)?s.call(e,i):s},Mi.longDateFormat=function(t){var e=this._longDateFormat[t],i=this._longDateFormat[t.toUpperCase()];return e||!i?e:(this._longDateFormat[t]=i.replace(/MMMM|MM|DD|dddd/g,(function(t){return t.slice(1)})),this._longDateFormat[t])},Mi.invalidDate=function(){return this._invalidDate},Mi.ordinal=function(t){return this._ordinal.replace("%d",t)},Mi.preparse=Si,Mi.postformat=Si,Mi.relativeTime=function(t,e,i,s){var r=this._relativeTime[i];return O(r)?r(t,e,i,s):r.replace(/%d/i,t)},Mi.pastFuture=function(t,e){var i=this._relativeTime[t>0?"future":"past"];return O(i)?i(e):i.replace(/%s/i,e)},Mi.set=function(t){var e,i;for(i in t)O(e=t[i])?this[i]=e:this["_"+i]=e;this._config=t,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},Mi.months=function(t,e){return t?r(this._months)?this._months[t.month()]:this._months[(this._months.isFormat||Nt).test(e)?"format":"standalone"][t.month()]:r(this._months)?this._months:this._months.standalone},Mi.monthsShort=function(t,e){return t?r(this._monthsShort)?this._monthsShort[t.month()]:this._monthsShort[Nt.test(e)?"format":"standalone"][t.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},Mi.monthsParse=function(t,e,i){var s,r,n;if(this._monthsParseExact)return Ht.call(this,t,e,i);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(r=u([2e3,s]),i&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(r,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(r,"").replace(".","")+"$","i")),i||this._monthsParse[s]||(n="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[s]=new RegExp(n.replace(".",""),"i")),i&&"MMMM"===e&&this._longMonthsParse[s].test(t))return s;if(i&&"MMM"===e&&this._shortMonthsParse[s].test(t))return s;if(!i&&this._monthsParse[s].test(t))return s}},Mi.monthsRegex=function(t){return this._monthsParseExact?(d(this,"_monthsRegex")||Et.call(this),t?this._monthsStrictRegex:this._monthsRegex):(d(this,"_monthsRegex")||(this._monthsRegex=qt),this._monthsStrictRegex&&t?this._monthsStrictRegex:this._monthsRegex)},Mi.monthsShortRegex=function(t){return this._monthsParseExact?(d(this,"_monthsRegex")||Et.call(this),t?this._monthsShortStrictRegex:this._monthsShortRegex):(d(this,"_monthsShortRegex")||(this._monthsShortRegex=Rt),this._monthsShortStrictRegex&&t?this._monthsShortStrictRegex:this._monthsShortRegex)},Mi.week=function(t){return zt(t,this._week.dow,this._week.doy).week},Mi.firstDayOfYear=function(){return this._week.doy},Mi.firstDayOfWeek=function(){return this._week.dow},Mi.weekdays=function(t,e){var i=r(this._weekdays)?this._weekdays:this._weekdays[t&&!0!==t&&this._weekdays.isFormat.test(e)?"format":"standalone"];return!0===t?Zt(i,this._week.dow):t?i[t.day()]:i},Mi.weekdaysMin=function(t){return!0===t?Zt(this._weekdaysMin,this._week.dow):t?this._weekdaysMin[t.day()]:this._weekdaysMin},Mi.weekdaysShort=function(t){return!0===t?Zt(this._weekdaysShort,this._week.dow):t?this._weekdaysShort[t.day()]:this._weekdaysShort},Mi.weekdaysParse=function(t,e,i){var s,r,n;if(this._weekdaysParseExact)return Qt.call(this,t,e,i);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(r=u([2e3,1]).day(s),i&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(r,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(r,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(r,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[s]||(n="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[s]=new RegExp(n.replace(".",""),"i")),i&&"dddd"===e&&this._fullWeekdaysParse[s].test(t))return s;if(i&&"ddd"===e&&this._shortWeekdaysParse[s].test(t))return s;if(i&&"dd"===e&&this._minWeekdaysParse[s].test(t))return s;if(!i&&this._weekdaysParse[s].test(t))return s}},Mi.weekdaysRegex=function(t){return this._weekdaysParseExact?(d(this,"_weekdaysRegex")||se.call(this),t?this._weekdaysStrictRegex:this._weekdaysRegex):(d(this,"_weekdaysRegex")||(this._weekdaysRegex=te),this._weekdaysStrictRegex&&t?this._weekdaysStrictRegex:this._weekdaysRegex)},Mi.weekdaysShortRegex=function(t){return this._weekdaysParseExact?(d(this,"_weekdaysRegex")||se.call(this),t?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(d(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=ee),this._weekdaysShortStrictRegex&&t?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},Mi.weekdaysMinRegex=function(t){return this._weekdaysParseExact?(d(this,"_weekdaysRegex")||se.call(this),t?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(d(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=ie),this._weekdaysMinStrictRegex&&t?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},Mi.isPM=function(t){return"p"===(t+"").toLowerCase().charAt(0)},Mi.meridiem=function(t,e,i){return t>11?i?"pm":"PM":i?"am":"AM"},me("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(t){var e=t%10;return t+(1===k(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th")}}),s.lang=D("moment.lang is deprecated. Use moment.locale instead.",me),s.langData=D("moment.langData is deprecated. Use moment.localeData instead.",pe);var Ti=Math.abs;function Oi(t,e,i,s){var r=Ke(e,i);return t._milliseconds+=s*r._milliseconds,t._days+=s*r._days,t._months+=s*r._months,t._bubble()}function Ii(t){return t<0?Math.floor(t):Math.ceil(t)}function Ai(t){return 4800*t/146097}function Wi(t){return 146097*t/4800}function Ni(t){return function(){return this.as(t)}}var Gi=Ni("ms"),Ci=Ni("s"),Hi=Ni("m"),Li=Ni("h"),Fi=Ni("d"),Ri=Ni("w"),qi=Ni("M"),Ei=Ni("Q"),$i=Ni("y");function ji(t){return function(){return this.isValid()?this._data[t]:NaN}}var Vi=ji("milliseconds"),Ui=ji("seconds"),zi=ji("minutes"),Bi=ji("hours"),Zi=ji("days"),Ki=ji("months"),Ji=ji("years"),Xi=Math.round,Qi={ss:44,s:45,m:45,h:22,d:26,M:11};function ts(t,e,i,s,r){return r.relativeTime(e||1,!!i,t,s)}var es=Math.abs;function is(t){return(t>0)-(t<0)||+t}function ss(){if(!this.isValid())return this.localeData().invalidDate();var t,e,i=es(this._milliseconds)/1e3,s=es(this._days),r=es(this._months);t=w(i/60),e=w(t/60),i%=60,t%=60;var n=w(r/12),a=r%=12,o=s,h=e,l=t,d=i?i.toFixed(3).replace(/\.?0+$/,""):"",c=this.asSeconds();if(!c)return"P0D";var u=c<0?"-":"",f=is(this._months)!==is(c)?"-":"",m=is(this._days)!==is(c)?"-":"",g=is(this._milliseconds)!==is(c)?"-":"";return u+"P"+(n?f+n+"Y":"")+(a?f+a+"M":"")+(o?m+o+"D":"")+(h||l||d?"T":"")+(h?g+h+"H":"")+(l?g+l+"M":"")+(d?g+d+"S":"")}var rs=Fe.prototype;return rs.isValid=function(){return this._isValid},rs.abs=function(){var t=this._data;return this._milliseconds=Ti(this._milliseconds),this._days=Ti(this._days),this._months=Ti(this._months),t.milliseconds=Ti(t.milliseconds),t.seconds=Ti(t.seconds),t.minutes=Ti(t.minutes),t.hours=Ti(t.hours),t.months=Ti(t.months),t.years=Ti(t.years),this},rs.add=function(t,e){return Oi(this,t,e,1)},rs.subtract=function(t,e){return Oi(this,t,e,-1)},rs.as=function(t){if(!this.isValid())return NaN;var e,i,s=this._milliseconds;if("month"===(t=G(t))||"quarter"===t||"year"===t)switch(e=this._days+s/864e5,i=this._months+Ai(e),t){case"month":return i;case"quarter":return i/3;case"year":return i/12}else switch(e=this._days+Math.round(Wi(this._months)),t){case"week":return e/7+s/6048e5;case"day":return e+s/864e5;case"hour":return 24*e+s/36e5;case"minute":return 1440*e+s/6e4;case"second":return 86400*e+s/1e3;case"millisecond":return Math.floor(864e5*e)+s;default:throw new Error("Unknown unit "+t)}},rs.asMilliseconds=Gi,rs.asSeconds=Ci,rs.asMinutes=Hi,rs.asHours=Li,rs.asDays=Fi,rs.asWeeks=Ri,rs.asMonths=qi,rs.asQuarters=Ei,rs.asYears=$i,rs.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*k(this._months/12):NaN},rs._bubble=function(){var t,e,i,s,r,n=this._milliseconds,a=this._days,o=this._months,h=this._data;return n>=0&&a>=0&&o>=0||n<=0&&a<=0&&o<=0||(n+=864e5*Ii(Wi(o)+a),a=0,o=0),h.milliseconds=n%1e3,t=w(n/1e3),h.seconds=t%60,e=w(t/60),h.minutes=e%60,i=w(e/60),h.hours=i%24,a+=w(i/24),r=w(Ai(a)),o+=r,a-=Ii(Wi(r)),s=w(o/12),o%=12,h.days=a,h.months=o,h.years=s,this},rs.clone=function(){return Ke(this)},rs.get=function(t){return t=G(t),this.isValid()?this[t+"s"]():NaN},rs.milliseconds=Vi,rs.seconds=Ui,rs.minutes=zi,rs.hours=Bi,rs.days=Zi,rs.weeks=function(){return w(this.days()/7)},rs.months=Ki,rs.years=Ji,rs.humanize=function(t){if(!this.isValid())return this.localeData().invalidDate();var e=this.localeData(),i=function(t,e,i){var s=Ke(t).abs(),r=Xi(s.as("s")),n=Xi(s.as("m")),a=Xi(s.as("h")),o=Xi(s.as("d")),h=Xi(s.as("M")),l=Xi(s.as("y")),d=r<=Qi.ss&&["s",r]||r<Qi.s&&["ss",r]||n<=1&&["m"]||n<Qi.m&&["mm",n]||a<=1&&["h"]||a<Qi.h&&["hh",a]||o<=1&&["d"]||o<Qi.d&&["dd",o]||h<=1&&["M"]||h<Qi.M&&["MM",h]||l<=1&&["y"]||["yy",l];return d[2]=e,d[3]=+t>0,d[4]=i,ts.apply(null,d)}(this,!t,e);return t&&(i=e.pastFuture(+this,i)),e.postformat(i)},rs.toISOString=ss,rs.toString=ss,rs.toJSON=ss,rs.locale=ri,rs.localeData=ai,rs.toIsoString=D("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",ss),rs.lang=ni,j("X",0,0,"unix"),j("x",0,0,"valueOf"),dt("x",nt),dt("X",/[+-]?\d+(\.\d{1,3})?/),mt("X",(function(t,e,i){i._d=new Date(1e3*parseFloat(t,10))})),mt("x",(function(t,e,i){i._d=new Date(k(t))})),s.version="2.24.0",e=Ne,s.fn=ki,s.min=function(){return He("isBefore",[].slice.call(arguments,0))},s.max=function(){return He("isAfter",[].slice.call(arguments,0))},s.now=function(){return Date.now?Date.now():+new Date},s.utc=u,s.unix=function(t){return Ne(1e3*t)},s.months=function(t,e){return Pi(t,e,"months")},s.isDate=h,s.locale=me,s.invalid=g,s.duration=Ke,s.isMoment=x,s.weekdays=function(t,e,i){return Yi(t,e,i,"weekdays")},s.parseZone=function(){return Ne.apply(null,arguments).parseZone()},s.localeData=pe,s.isDuration=Re,s.monthsShort=function(t,e){return Pi(t,e,"monthsShort")},s.weekdaysMin=function(t,e,i){return Yi(t,e,i,"weekdaysMin")},s.defineLocale=ge,s.updateLocale=function(t,e){if(null!=e){var i,s,r=le;null!=(s=fe(t))&&(r=s._config),e=I(r,e),(i=new A(e)).parentLocale=de[t],de[t]=i,me(t)}else null!=de[t]&&(null!=de[t].parentLocale?de[t]=de[t].parentLocale:null!=de[t]&&delete de[t]);return de[t]},s.locales=function(){return P(de)},s.weekdaysShort=function(t,e,i){return Yi(t,e,i,"weekdaysShort")},s.normalizeUnits=G,s.relativeTimeRounding=function(t){return void 0===t?Xi:"function"==typeof t&&(Xi=t,!0)},s.relativeTimeThreshold=function(t,e){return void 0!==Qi[t]&&(void 0===e?Qi[t]:(Qi[t]=e,"s"===t&&(Qi.ss=e-1),!0))},s.calendarFormat=function(t,e){var i=t.diff(e,"days",!0);return i<-6?"sameElse":i<-1?"lastWeek":i<0?"lastDay":i<1?"sameDay":i<2?"nextDay":i<7?"nextWeek":"sameElse"},s.prototype=ki,s.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},s}()}));t(".%L"),t(":%S"),t("%H:%M"),t("%H:%M"),t("%m%d"),t("%m%d"),t("%y");const Ee=function(t){let e="";if(t&&t>=1e9){const i=qe.duration(t/1e9,"seconds");i.years()>0&&(e+=i.years()+"Y"),i.months()>0&&(e+=i.months()+"M"),i.days()>0&&(e+=i.days()+"D"),i.hours()>0&&(e+=i.hours()+"h"),i.minutes()>0&&(e+=i.minutes()+"m"),i.seconds()>0&&(e+=i.seconds()+"s")}return e},$e={up:t=>t.open<=t.close,down:t=>t.open>t.close},je=Object.keys($e),Ve={up:t=>t.open<t.close,down:t=>t.open>t.close,equal:t=>t.open===t.close},Ue=Object.keys(Ve),ze=function(t,e,i){return function(){const s=Array.from(arguments).join(" "),r=`color: white; background-color: ${i};`;console.log.apply(this,["%c "+e+" %c "+s,r,t])}},Be=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"TqChart",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"plum";return{log:ze("color: green;",t,e),info:ze("color: blue;",t,e),debug:ze("color: pink;",t,e),warn:ze("color: orange;",t,e),error:ze("color: red;",t,e)}},Ze=function(t){let e="string"==typeof t?t:"";if((t=>Number.isInteger(Number(t)))(t)){const i=t.toString(16).padStart(8,"F"),s=parseInt(i.slice(0,2),16)/255;e=`rgba(${parseInt(i.slice(2,4),16)}, ${parseInt(i.slice(4,6),16)}, ${parseInt(i.slice(6),16)}, ${s})`}return e};class Ke{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,i=t.xScale,s=t.yScale,r=t.bar;this.id=e||(new Date).getTime(),this.bar=r,this.xScale=i,this.yScale=s,this.paths=[]}}class Je extends Ke{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({id:t.id,xScale:t.xScale,yScale:t.yScale,bar:t.bar}),Ue.forEach(t=>this.paths.push([this.id,"candle","line",t].join("."))),Ue.forEach(t=>this.paths.push([this.id,"candle","body",t].join(".")))}getYDomain(t,e,i){const s=i.slice(t,e+1);let r=[c(s,t=>t&&t.low),u(s,t=>t&&t.high)],n=r[0],a=r[1];return[n-=.2*(a-n),a+=.2*(a-n)]}calcPaths(t,e,i){if(!this.yScale||!this.xScale||!this.bar)return;const s={};this.paths.forEach((function(t){s[t]=""}));for(let r=t;r<=e;r++)"kline"===this.id&&console.info(r,i,i[r]),i[r]&&Ue.forEach(t=>{if(Ve[t](i[r])){const e="up"===t?.5:0;s[[this.id,"candle","body",t].join(".")]+=this._bodyPath(i[r],r,e),s[[this.id,"candle","line",t].join(".")]+=this._linePath(i[r],r)}});return s}_bodyPath(t,e,i){const s=Math.round(this.yScale(t.open))+i,r=Math.round(this.yScale(t.close))+i,n=this.xScale(e)+this.bar.barPadding;if(Number.isNaN(s)||Number.isNaN(r)||Number.isNaN(n))return"";const a=this.bar.barWidth-2*this.bar.barPadding;return s!==r?`M${n+i} ${s} L${n+a-i} ${s} L${n+a-i} ${r} L${n+i} ${r} L${n+i} ${s}`:`M${n} ${s+.5} L${n+a} ${s+.5}`}_linePath(t,e){const i=Math.round(this.yScale(t.high)),s=Math.round(this.yScale(t.low)),r=this.xScale(e)+this.bar.barWidth/2;return Number.isNaN(i)||Number.isNaN(s)||Number.isNaN(r)?"":`M ${r} ${i} L ${r} ${s}`}}class Xe extends Ke{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({id:t.id,xScale:t.xScale,yScale:t.yScale,bar:t.bar}),je.forEach(t=>this.paths.push([this.id,"body",t].join(".")))}getYDomain(t,e,i){const s=i.slice(t,e+1);return[0,1.2*u(s,t=>t&&t.volume)]}calcPaths(t,e,i){if(!this.yScale||!this.xScale||!this.bar)return;const s={};this.paths.forEach((function(t){s[t]=""}));for(let r=t;r<=e;r++)i[r]&&je.forEach(t=>{$e[t](i[r])&&(s[[this.id,"body",t].join(".")]+=this.bodyPath(i[r],r,"up"===t?.5:0))});return s}bodyPath(t,e,i){const s=Math.ceil(this.yScale(0))+(0===i?1:i),r=Math.min(Math.round(s-this.yScale(t.volume)),s-i),n=this.xScale(e)+this.bar.barPadding,a=this.bar.barWidth-2*this.bar.barPadding;return`M${n+i} ${s}L${n+a-i} ${s}L ${n+a-i} ${s-r}L${n+i} ${s-r}L${n+i} ${s}`}}class Qe extends Ke{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({id:t.id,xScale:t.xScale,yScale:t.yScale,bar:t.bar}),this.paths=["oi"]}getYDomain(t,e,i){const s=i.slice(t,e+1);let r=[c(s,t=>t&&t.close_oi),u(s,t=>t&&t.close_oi)],n=r[0],a=r[1];return[n-=.2*(a-n),a+=.2*(a-n)]}calcPaths(t,e,i){if(!this.yScale||!this.xScale||!this.bar)return;let s="";for(let r=t;r<=e;r++){if(!i[r])continue;const t=this.yScale(i[r].close_oi);s+=""===s?"M":"L",s+=`${this.xScale(r)+this.bar.barWidth/2} ${t} `}return{oi:s}}}class ti extends Ke{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,i=t.xScale,s=t.yScale,r=t.bar,n=t.propName,a=t.min,o=t.max;super({id:e,xScale:i,yScale:s,bar:r}),this.min=a,this.max=o,this.propName=n||"value",this.paths=["value"]}getYDomain(t,e,i){if(Number.isFinite(this.min)&&Number.isFinite(this.max))return[this.min,this.max];{const s=i.slice(t,e+1);return[c(s,t=>t&&t[this.propName]),u(s,t=>t&&t[this.propName])]}}calcPaths(t,e,i){if(!this.yScale||!this.xScale||!this.bar)return;let s="M";for(let r=t;r<=e;r++){if(!i[r]){s.endsWith("M")||(s+="M");continue}const t=this.yScale(i[r][this.propName]),e=this.xScale(r)+this.bar.barWidth/2;void 0===t||Number.isNaN(t)||Number.isNaN(e)?s.endsWith("M")||(s+="M"):(s+=s.endsWith("M")?"":"L",s+=`${e} ${t}`)}return{value:s.replace(/[LM]$/,"")}}}class ei extends Ke{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,i=t.xScale,s=t.yScale,r=t.bar,n=t.propName,a=t.isHollow,o=t.min,h=t.max;super({id:e,xScale:i,yScale:s,bar:r}),this.isHollow=a||!1,this.min=o,this.max=h,this.propName=n||"value",this.paths=["value"]}getYDomain(t,e,i){if(Number.isFinite(this.min)&&Number.isFinite(this.max))return[this.min,this.max];{const s=i.slice(t,e+1);return[0,u(s,t=>t&&t[this.propName])]}}calcPaths(t,e,i){if(!this.yScale||!this.xScale||!this.bar)return;let s="";for(let r=t;r<=e;r++)i[r]&&(s+=this.bodyPath(i[r],r,this.isHollow?.5:0));return{value:s}}bodyPath(t,e,i){const s=Math.floor(this.yScale(0)),r=Math.round(s-this.yScale(t[this.propName])),n=this.xScale(e)+this.bar.barPadding;if(Number.isNaN(r)||Number.isNaN(n))return"";const a=this.bar.barWidth-2*this.bar.barPadding;return`M ${n+i} ${s-i} L ${n+a-i} ${s-i} L ${n+a-i} ${s-r+i} L ${n+i} ${s-r+i} L ${n+i} ${s-i}`}}class ii extends Ke{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,i=t.xScale,s=t.yScale,r=t.bar,n=t.propName,a=t.min,o=t.max;super({id:e,xScale:i,yScale:s,bar:r}),this.min=a,this.max=o,this.propName=n||"value",this.paths=["value"]}getYDomain(t,e,i){if(Number.isFinite(this.min)&&Number.isFinite(this.max))return[this.min,this.max];{const s=i.slice(t,e+1);return[c(s,t=>t&&t[this.propName]),u(s,t=>t&&t[this.propName])]}}calcPaths(t,e,i){if(!this.yScale||!this.xScale||!this.bar)return;let s="";for(let r=t;r<=e;r++){if(!i[r])continue;const t=this.yScale(i[r][this.propName]),e=this.xScale(r)+this.bar.barWidth/2;if(Number.isNaN(t)||Number.isNaN(e))continue;const n=3;s+=`M ${e-n} ${t} a ${n}, ${n} 0 1,0 ${2*n},0 a ${n}, ${n} 0 1,0 ${2*-n},0 `}return{value:s}}}class si{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.chart,i=t.boardId,s=t.plotId,r=void 0===s?"":s,n=t.yAlign,a=void 0===n?"right":n,o=t.type,h=void 0===o?"candle":o,l=t.color,d=void 0===l?"red":l,c=t.width,u=void 0===c?2:c,f=t.dash,m=void 0!==f&&f,g=t.data;this.chart=e,this.boardId=i,this.plotId=r,this.yAlign=a,this.board=this.chart.boards[i],this.data=g,this.type=h,this.color=d,this.width=Number.isFinite(u)?Math.round(u):2,this.dash=m,this.g=this.board.plotG.append("g").attr("class",`plot ${this.boardId} ${this.plotId}`),this.path=null,this._initPath()}_initPath(){switch(this.type){case"candle":this.path=new Je({id:this.plotId,xScale:this.chart.xAxis.xScale,yScale:this.chart.boards[this.boardId][this.yAlign+"YAxis"].yScale,bar:this.chart.bar});break;case"volume":this.path=new Xe({id:this.plotId,xScale:this.chart.xAxis.xScale,yScale:this.chart.boards[this.boardId][this.yAlign+"YAxis"].yScale,bar:this.chart.bar});break;case"oi":this.path=new Qe({id:this.plotId,xScale:this.chart.xAxis.xScale,yScale:this.chart.boards[this.boardId][this.yAlign+"YAxis"].yScale,bar:this.chart.bar});break;case"dash":case"line":this.path=new ti({id:this.plotId,xScale:this.chart.xAxis.xScale,yScale:this.chart.boards[this.boardId][this.yAlign+"YAxis"].yScale,bar:this.chart.bar});break;case"bar":this.path=new ei({id:this.plotId,xScale:this.chart.xAxis.xScale,yScale:this.chart.boards[this.boardId][this.yAlign+"YAxis"].yScale,bar:this.chart.bar});break;case"dot":this.path=new ii({id:this.plotId,xScale:this.chart.xAxis.xScale,yScale:this.chart.boards[this.boardId][this.yAlign+"YAxis"].yScale,bar:this.chart.bar})}for(let t=0;t<this.path.paths.length;t++)this._appendPlotTypePath(this.path.paths[t])}_appendPlotTypePath(t){if(Array.isArray(t)||(t=t.split(".")),this.g.selectAll(`path.${t.join(".")}`).data(t=>[t]).enter().append("path").attr("class",t.join(" ")),"line"===this.type||"dash"===this.type){const e="string"==typeof this.color?this.color:"";this.g.selectAll(`path.${t.join(".")}`).style("fill","none").attr("stroke",e).attr("stroke-width",this.width+"px").attr("stroke-dasharray",this.dash?"4 4":"0")}else"bar"===this.type?this.g.selectAll(`path.${t.join(".")}`).style("fill",this.color).attr("stroke","none"):"dot"===this.type&&this.g.selectAll(`path.${t.join(".")}`).style("fill",this.color).attr("stroke","none")}getYDomain(t,e,i){return this.path.getYDomain(t,e,i)}draw(t,e,i){const s=this.path.calcPaths(t,e,i);for(const t in s)try{this.g.select(`path.${t}`).attr("d",s[t])}catch(t){this.chart.tqChartConsole.error(t)}}remove(){this.g.remove()}}const ri={HighlightBar:class{constructor(t,e,i){this.tqchart=t,this.id=e,this.klineId=i}update(t){this.klineId=t}resize(){this.g.attr("width",this.tqchart.bar.barWidth).attr("height",this.tqchart.innerHeight)}draw(){this.g||(this.g=this.tqchart.bgShapesG.append("rect").attr("class","highlight").attr("width",this.tqchart.bar.barWidth).attr("height",this.tqchart.innerHeight));const t=this.tqchart.chartController.revertIdToPx(this.klineId);this.g.attr("transform",`translate(${t},0)`)}clear(){this.g.remove()}}};class ni{constructor(t,e,i){this.tqchart=t,this.managerId=e,this.typeClass=i,this.contents={}}add(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return this.contents[t]?this.contents[t].update(...i):this.contents[t]=new ri[this.typeClass](this.tqchart,t,...i),this.contents[t]}each(t,e){for(var i=arguments.length,s=new Array(i>2?i-2:0),r=2;r<i;r++)s[r-2]=arguments[r];for(const i in this.contents)if(this.contents[i]){this.contents[i][t](e,...s)}}get(t){return this.contents[t]||null}remove(t){this.contents[t].clear(),delete this.contents[t]}removeAll(){for(const t in this.contents)this.contents[t].clear(),delete this.contents[t]}}class ai{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,i=t.chart,s=t.board,r=t.boardId,n=t.parentG,a=t.type,o=t.yAlign,h=t.fill,l=t.fillOpacity,d=t.stroke,c=t.strokeWidth,u=t.strokeOpacity,f=t.strokeDasharray;this.id=e||(new Date).getTime(),this.chart=i,this.boardId=r||"main",this.board=s||this.chart.boards[this.boardId],this.parentG=n,this.g=n?n.append("g").attr("class",this.boardId+" mark "+a+" "+this.id):this.board.markG.append("g").attr("class",this.boardId+" mark "+a+" "+this.id),this.yAlign=o||"right",this.type=a,this.fill=h||"none",this.fillOpacity=l||.5,this.stroke=d||"#bbbbbb",this.strokeWidth=c||1,this.strokeOpacity=u||.5,this.strokeDasharray=f||"0",this._show=!0}update(t){this.xPos1=void 0===t.xPos1?this.xPos1:t.xPos1,this.x1=void 0===t.x1?this.x1:t.x1,this.dt1=void 0===t.dt1?this.dt1:t.dt1,this.yPos1=void 0===t.yPos1?this.yPos1:t.yPos1,this.y1=void 0===t.y1?this.y1:t.y1,this.xPos2=void 0===t.xPos2?this.xPos2:t.xPos2,this.x2=void 0===t.x2?this.x2:t.x2,this.dt2=void 0===t.dt2?this.dt2:t.dt2,this.yPos2=void 0===t.yPos2?this.yPos2:t.yPos2,this.y2=void 0===t.y2?this.y2:t.y2}show(){this.g&&!this._show&&(this._show=!0,this.g.attr("visibility","visible"))}hide(){this.g&&this._show&&(this._show=!1,this.g.attr("visibility","hidden"))}remove(){this.g.remove()}revertSomeToPos(t){const e={x:null,y:null};return Number.isFinite(this["xPos"+t])?e.x=this["xPos"+t]:Number.isFinite(this["x"+t])?e.x=this.revertIdToPos(this["x"+t]):Number.isFinite(this["dt"+t])&&(e.x=this.revertIdToPos(this.revertDtToId(this["dt"+t]))),Number.isFinite(this["yPos"+t])?e.y=this["yPos"+t]:Number.isFinite(this["y"+t])&&(e.y=this.revertValueToYPos(this["y"+t])),e}revertDtToId(t){const e=this.chart.mainSeries,i=[this.chart.range.leftId,this.chart.range.rightId],s=i[0],r=i[1];if(!e||!e.data||!e.data[s]||t<e.data[s].datetime)return null;const n=e.data[r]?r:e.last_id;if(t<=e.data[n].datetime)for(let i=s;i<n+1;i++)if(t-e.data[i].datetime<=0)return i;return null}revertIdToPos(t){return Math.round(this.chart.xAxis.xScale(t))+Math.floor(this.chart.bar.barWidth/2)}revertValueToYPos(t){return t&&this.board[this.yAlign+"YAxis"]?Math.round(this.board[this.yAlign+"YAxis"].yScale(t)):null}isPointInChart(t){const e=t.x,i=t.y;return e>=0&&e<=this.chart.innerWidth&&i>=0&&i<=this.chart.innerHeight}}class oi extends ai{constructor(t){super(t),this.type="text",this.xPos1=t.xPos1,this.x1=t.x1,this.dt1=t.dt1,this.yPos1=t.yPos1,this.y1=t.y1,this.text=t.text,this.size=t.size,this.textG=this.g.append("text").style("font-size",this.size).style("fill",this.fill)}update(t){super.update(t),this.text=void 0===t.text?this.text:t.text}draw(){const t=this.revertSomeToPos("1");if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&this.text)return this.show(),void this.textG.attr("x",t.x).attr("y",t.y).text(this.text);this.hide()}}class hi extends ai{constructor(t){super(t),this.type="line",this.lineG=this.g.append("line"),this.lineG.style("fill","none").attr("stroke",this.stroke).attr("stroke-width",this.strokeWidth).attr("stroke-opacity",this.strokeOpacity).attr("stroke-dasharray",this.strokeDasharray),this.xPos1=t.xPos1,this.x1=t.x1,this.dt1=t.dt1,this.yPos1=t.yPos1,this.y1=t.y1,this.xPos2=t.xPos2,this.x2=t.x2,this.dt2=t.dt2,this.yPos2=t.yPos2,this.y2=t.y2,this.text=t.text,this.clamp=t.clamp}update(t){super.update(t),this.x1=t.x1||this.x1,this.y1=t.y1||this.y1,this.text=void 0===t.text?this.text:t.text,this.clamp=void 0===t.clamp?this.clamp:t.clamp}draw(){const t=this.revertSomeToPos("1"),e=this.revertSomeToPos("2");Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(e.x)&&Number.isFinite(e.y)&&(this.clamp&&t.y-e.y<1e-6&&(t.y<0||e.y<0?t.y=e.y=0:(t.y>this.chart.innerHeight||e.y>this.chart.innerHeight)&&(t.y=e.y=this.chart.innerHeight)),this.lineG.attr("x1",t.x).attr("y1",t.y).attr("x2",e.x).attr("y2",e.y),this.show(),this.text&&(this.textG=this.textG||this.g.append("text"),this.textG.attr("x",t.x).attr("y",t.y).attr("dy",t.y<15?"12px":"-2px").text(this.text)))}}class li extends ai{constructor(t){super(t),this.type="rect",this.rectG=this.g.append("rect"),this.rectG.style("fill",this.fill).attr("fill-opacity",this.fillOpacity).attr("stroke",this.stroke).attr("stroke-width",this.strokeWidth).attr("stroke-opacity",this.strokeOpacity).attr("stroke-dasharray",this.strokeDasharray),this.xPos1=t.xPos1,this.x1=t.x1,this.dt1=t.dt1,this.yPos1=t.yPos1,this.y1=t.y1,this.xPos2=t.xPos2,this.x2=t.x2,this.dt2=t.dt2,this.yPos2=t.yPos2,this.y2=t.y2,this.width=t.width,this.height=t.height}update(t){super.update(t),this.width=void 0===t.width?this.width:t.width,this.height=void 0===t.height?this.height:t.height}draw(){const t=this.revertSomeToPos("1");let e=.5;if("none"===this.rectG.attr("stroke")&&(e=0),Number.isFinite(t.x)&&Number.isFinite(t.y)){if(Number.isFinite(this.width)&&Number.isFinite(this.height))return this.rectG.attr("x",t.x+e).attr("y",t.y+e).attr("width",this.width).attr("height",this.height),void this.show();const i=this.revertSomeToPos("2");if(Number.isFinite(i.x)&&Number.isFinite(i.y))return this.rectG.attr("x",t.x+e).attr("y",t.y+e).attr("width",Math.abs(i.x-t.x)).attr("height",Math.abs(i.y-t.y)),void this.show()}this.hide()}}class di extends ai{constructor(t){super(t),this.type="arrow",this.arrowG=this.g.append("path"),this.arrowG.style("fill",this.fill).attr("stroke",this.stroke).attr("stroke-width",this.strokeWidth).attr("stroke-opacity",this.strokeOpacity).attr("stroke-dasharray",this.strokeDasharray),this.xPos1=t.xPos1,this.x1=t.x1,this.dt1=t.dt1,this.yPos1=t.yPos1,this.y1=t.y1,this.xPos2=t.xPos2,this.x2=t.x2,this.dt2=t.dt2,this.yPos2=t.yPos2,this.y2=t.y2,this.width=t.width,this.height=t.height,this.direction=t.direction}update(t){super.update(t),this.width=void 0===t.width?this.width:t.width,this.height=void 0===t.height?this.height:t.height,this.direction=void 0===t.direction?this.direction:t.direction}draw(){const t=this.revertSomeToPos("1"),e=this.width||this.chart.bar.barWidth,i=this.height||this.chart.bar.barWidth,s="up"===this.direction?1:-1,r="none"===this.stroke?0:.5;if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&this.isPointInChart(t)){const n=Math.round(e/3),a=`M ${t.x+e/2} ${t.y} l ${-e/2} ${s*i/2} l ${n-r} 0 l 0 ${s*i/2} l ${n} 0 l 0 ${-1*s*i/2} l ${n} 0 z`;this.arrowG.attr("d",a),this.show()}else this.hide()}}class ci{constructor(t){this.chart=t,this.marks={}}addMark(t){return t.id=t.id||(new Date).getTime(),this.marks[t.id]?this.marks[t.id].update(t):(t.chart=t.chart||this.chart,t.boardId=t.boardId||"main",t.board=t.board||this.chart.boards[t.boardId],t.yAlign=t.yAlign||"right","line"===t.type?this.marks[t.id]=new hi(t):"rect"===t.type?this.marks[t.id]=new li(t):"arrow"===t.type?this.marks[t.id]=new di(t):"text"===t.type?this.marks[t.id]=new oi(t):this.chart.tqChartConsole.error(`未支持 ${t.type} 类型标记，[line|rect|arrow|text]`)),this.marks[t.id]}removeMarkAll(){for(const t in this.marks)this.marks[t].remove(),delete this.marks[t]}removeMark(t){this.marks[t]&&this.marks[t].remove(),delete this.marks[t]}showMark(t){this.marks[t].show()}hideMark(t){this.marks[t].hide()}draw(){const t=this.chart.mainSeries;let e=[this.chart.range.leftId,this.chart.range.rightId],i=e[0],s=e[1];if(s=t.data[s]?s:t.last_id,t.data[i]&&t.data[s]){const e=t.data[i].datetime,r=t.data[s].datetime;for(const i in this.marks){const s=this.marks[i];if("arrow"===s.type)if(s.dt1>=e&&s.dt1<=r){const e=this.marks[i].revertDtToId(s.dt1);this.marks[i].x1=e,this.marks[i].y1="up"===this.marks[i].direction?t.data[e].low:t.data[e].high,this.marks[i].draw()}else this.marks[i].hide();else this.marks[i].draw()}}}}class ui{constructor(t){this.tqchart=t,this._board=null,this._g=null,this.trades={}}get board(){return null===this._board&&(this._board=this.tqchart.boards.main?this.tqchart.boards.main:null),this._board}get g(){return null===this._g&&(this._g=this.board.markG.append("g").attr("class","tradearrow")),this._g}add(t,e){this.trades[t]||(this.trades[t]=e)}removeAll(){this.g.select("path").remove();for(const t in this.trades)delete this.trades[t]}revertValueToYPos(t){return t&&this.board.rightYAxis?Math.round(this.board.rightYAxis.yScale(t)):null}draw(){const t=[],e={},i={},s=this.tqchart.mainSeries;let r=[this.tqchart.range.leftId,this.tqchart.range.rightId],n=r[0],a=r[1];if(a=s.data[a]?a:s.last_id,!s.data[n]||!s.data[a])return;const o=[s.data[n].datetime,s.data[a].datetime],h=o[0],l=o[1];for(const r in this.trades){const o=this.trades[r];if(o.trade_date_time>=h&&o.trade_date_time<=l+this.tqchart.duration){const r=this.tqchart.chartController.revertDtToId(o.trade_date_time,n,a);if(!r)continue;if("BUY"===o.direction)if(e[r])e[r].volume+=o.volume;else{const i={x:this.tqchart.chartController.revertIdToPx(r),y:this.revertValueToYPos(s.data[r].low),dir:"up",diff:"OPEN"===o.offset?0:.5,width:this.tqchart.bar.barWidth,volume:o.volume};e[r]=i,t.push(i)}else if("SELL"===o.direction)if(i[r])i[r].volume+=o.volume;else{const e={x:this.tqchart.chartController.revertIdToPx(r),y:this.revertValueToYPos(s.data[r].high),dir:"down",diff:"OPEN"===o.offset?0:.5,width:this.tqchart.bar.barWidth,volume:o.volume};i[r]=e,t.push(e)}}}this.drawArrows(t)}drawArrows(t){const e=this.g.selectAll("path").data(t);e.enter().append("path").attr("class",t=>t.dir).attr("d",this.getArrowPath),e.merge(e).attr("class",t=>t.dir).attr("d",this.getArrowPath),e.exit().remove()}getArrowPath(t){const e="up"===t.dir?1:-1,i=t.width,s=t.width,r=Math.round(s/3);return`M ${t.x+s/2} ${t.y} l ${-s/2} ${e*i/2} l ${r-t.diff} 0 l 0 ${e*i/2} l ${r} 0 l 0 ${-1*e*i/2} l ${r} 0 z`}}class fi{constructor(t){this.tqchart=t,this._board=null,this._g=null,this.datetimeKeys=[],this.positions={}}get board(){return null===this._board&&(this._board=this.tqchart.boards.main?this.tqchart.boards.main:null),this._board}get g(){return null===this._g&&(this._g=this.board.markG.append("g").attr("class","posrect")),this._g}add(t,e){this.positions[t]||(this.positions[t]=e,e.datetime=t,e.volume_net=e.volume_long-e.volume_short,e.klineId=this.tqchart.chartController.revertDtToId(t),this.datetimeKeys=Object.keys(this.positions).sort())}removeAll(){this.g.select("rect").remove();for(const t in this.positions)delete this.positions[t]}getPostionKlineId(t){return t.klineId?t.klineId:(t.klineId=this.tqchart.chartController.revertDtToId(t.datetime),t.klineId)}revertValueToYPos(t){return t&&this.board.rightYAxis?Math.round(this.board.rightYAxis.yScale(t)):null}draw(){const t=this.tqchart.mainSeries;let e=[this.tqchart.range.leftId,this.tqchart.range.rightId],i=e[0],s=e[1];if(s=t.data[s]?s:t.last_id,!t.data[i]||!t.data[s])return;const r=[t.data[i].datetime,t.data[s].datetime],n=r[0],a=r[1],o=[];for(let e=1;e<this.datetimeKeys.length;e++){const i=this.datetimeKeys[e-1],s=this.datetimeKeys[e];if(s<n)continue;if(n>a)break;const r=this.positions[i],h=this.positions[s],l=this.getPostionKlineId(r),d=this.getPostionKlineId(h);if(null!==l&&null!==d&&(d-l>1&&0!==r.volume_net)){const e=t.data[d].close-t.data[l].open;if(0!==r.volume_net&&0!==e){const i=Math.min(t.data[l].low,t.data[d].low),s=Math.max(t.data[l].high,t.data[d].high),n=r.volume_net*e>0?"profit":"loss";o.push({id:"rect"+l,x1:l,y1:s,x2:d+1,y2:i,className:n,stroke:"none"})}}}this.drawPosRect(o)}drawPosRect(t){const e=this.g.selectAll("rect").data(t);e.enter().append("rect").attr("class",t=>t.className).attr("x",t=>this.tqchart.chartController.revertIdToPx(t.x1)).attr("y",t=>this.revertValueToYPos(t.y1)).attr("width",t=>(t.x2-t.x1)*this.tqchart.bar.barWidth).attr("height",t=>this.revertValueToYPos(t.y2)-this.revertValueToYPos(t.y1)),e.merge(e).attr("class",t=>t.className).attr("x",t=>this.tqchart.chartController.revertIdToPx(t.x1)).attr("y",t=>this.revertValueToYPos(t.y1)).attr("width",t=>(t.x2-t.x1)*this.tqchart.bar.barWidth).attr("height",t=>this.revertValueToYPos(t.y2)-this.revertValueToYPos(t.y1)),e.exit().remove()}}class mi{constructor(t){this.fullWidth=t,this.barWidth=mi.BAR_WIDTH,this.barPadding=this._getBarPadding(),this.barNumbers=this._getBarNumbers()}_getBarPadding(){return this.barWidth<=3?0:this.barWidth<=17?1:2}_getBarNumbers(){return Math.floor(this.fullWidth/this.barWidth)}zoom(t){if(0===t)return;const e=t/Math.abs(t),i=this.barWidth+2*e;i<mi.BAR_WIDTH_MIN||i>mi.BAR_WIDTH_MAX||i===this.barWidth||(this.barWidth=i,this.barPadding=this._getBarPadding(),this.barNumbers=this._getBarNumbers())}setFullWidth(t){this.fullWidth=t,this.barNumbers=this._getBarNumbers()}}mi.BAR_WIDTH=9,mi.BAR_WIDTH_MAX=35,mi.BAR_WIDTH_MIN=1;class gi{constructor(t,e){this.leftId=Number.isInteger(t)?t:-1,this.rightId=Number.isInteger(e)?e:-1}reset(t,e){return!(!this.isInvalid()&&t===this.leftId&&e===this.rightId)&&(this.leftId=Number.isInteger(t)?t:-1,this.rightId=Number.isInteger(e)?e:-1,!0)}isInvalid(){return-1===this.leftId||-1===this.rightId}isEqual(t){return t.leftId===this.leftId&&t.rightId===this.rightId}copy(t){t instanceof gi&&(this.leftId=t.leftId,this.rightId=t.rightId)}}class pi{constructor(t){this.tqchart=t,this.range=new gi}_initRange(){let t=-1,e=-1;this.tqchart.mainSeries&&-1!==this.tqchart.mainSeries.last_id&&(t=(e=this.tqchart.mainSeries.last_id)-this.tqchart.bar.barNumbers+1),this.range.reset(t,e)}getRange(){return this.range.isInvalid()&&this._initRange(),this.range}init(){this._initRange()}setRange(t,e){t>=0&&e>=t?this.range.reset(t,e):(this.tqchart.tqChartConsole.warn("setRange 不传入数据，表示指定移动到最后端"),this.range.reset(-1,-1))}move(t){if(this.getRange().isInvalid())return this.tqchart.tqChartConsole.warn("move 拖动图表的时候，图表范围还未确定"),!1;let e=this.range.leftId-t,i=e+this.tqchart.bar.barNumbers-1;return e>=0&&e<=this.tqchart.mainSeries.last_id-this.tqchart.bar.barNumbers+10?this.range.reset(e,i):e<0?0!==this.range.leftId&&(i=(e=0)+this.tqchart.bar.barNumbers-1,this.range.reset(e,i)):e>=0&&t>0&&this.range.reset(e,i)}zoom(){let t=-1,e=-1;return e=(t=(t=this.range.rightId>this.tqchart.mainSeries.last_id?this.tqchart.mainSeries.last_id-this.tqchart.bar.barNumbers+1:this.range.rightId-this.tqchart.bar.barNumbers+1)<0?0:t)+this.tqchart.bar.barNumbers-1,this.range.reset(t,e),!0}revertIdToPx(t){return Math.round(this.tqchart.xAxis.xScale(t))}revertDtToId(t,e,i){const s=this.tqchart.mainSeries;if(!s||!s.data||this.range.isInvalid())return null;let r=!1;e>=0&&i>e?r=!0:(e=this.range.leftId,i=this.range.rightId);let n=e,a=i;if(a=a<=s.last_id?a:s.last_id,!s.data[n]||!s.data[a])return null;if(t>=s.data[a].datetime&&t<s.data[a].datetime+this.tqchart.duration)return a;if(t>=s.data[n].datetime&&t<=s.data[a].datetime){for(let e=n;e<a+1&&s.data[e];e++)if(t-s.data[e].datetime<=0)return e>=1?e-1:e;return null}if(r)return null;if(t>s.data[a].datetime){if(a===s.last_id)return null;for(let e=a;e<s.last_id&&s.data[e]&&s.data[e];e++)if(t-s.data[e].datetime<=0)return e>=1?e-1:e;return null}if(t<s.data[n].datetime){if(0===n)return null;for(let e=n;e>=0&&s.data[e];e--)if(t-s.data[e].datetime>=0)return e;return null}}}class yi extends Zt{constructor(t){super(),this.divDomId=t.id,this.outerWidth=t.width,this.outerHeight=t.height,this.margin=t.margin?t.margin:{top:15,right:50,bottom:20,left:80},this.innerWidth=this.outerWidth-this.margin.left-this.margin.right,this.innerHeight=this.outerHeight-this.margin.top-this.margin.bottom,this.mode="free",this.customRange=new gi,this.mainType="candle",this.bar=new mi(this.innerWidth),this.range=new gi,this.symbol=t.symbol||t.instrumentId,this.duration=t.duration||6e10,this.price_decs=t.price_decs||2,this.price_ticks=t.price_ticks,this.mainSeries=t.mainSeries,this.chartController=new pi(this),this.highlightManager=new ni(this,"highlight","HighlightBar"),this.tradeArrowManager=new ui(this),this.positionManager=new fi(this),this.tqChartConsole=Be("TqChart","plum")}setMode(t,e,i){"free"===t?(this.mode="free",e>=0&&i>=e?this.customRange.reset(e,i):this.customRange.reset()):"fixed"===t?e>=0&&i>=e?(this.mode="fixed",this.customRange.reset(e,i)):this.tqChartConsole.error("mode:fixed 必须指定 leftId rightId"):this.tqChartConsole.error(`不支持 mode:${t}， 只支持 mode:[free|fixed]`)}setRange(t,e){this.chartController.setRange(t,e),this.draw()}setMainType(t){"candle"===t||"close"===t?this.mainType=t:this.tqChartConsole.error("mainType 只支持 [candle|close] => [K线图|收盘价线]")}setMainSeries(t,e,i){t&&e&&i?(this.symbol=t,this.duration=e,this.mainSeries=i,this.backgroundText.text(`${this.symbol} ${Ee(this.duration)}`).attr("dy","-2"),this.chartController.init(),this.marksManager.removeMarkAll(),this.tradeArrowManager.removeAll(),this.positionManager.removeAll(),this._resetBoards(),this.draw()):this.tqChartConsole.error("setMainSeries 必须同时指定 symbol, duration, klines")}addHighlightBar(t,e){this.highlightManager.add(t,e)}addTradeArrow(t,e){this.tradeArrowManager.add(t,e)}addPositionRecord(t,e){this.positionManager.add(t,e)}init(){this._initSvgNode(),this._initEventListenners(),this.xAxis=new se(this);const t=le.GetMutilPlotsHeight(2,this.innerHeight);this.boards={main:new le(this,"main",t[0].top,t[0].height,!1),sub:new le(this,"sub",t[1].top,t[1].height,!0)},this.plots={mainkline:new si({chart:this,boardId:"main",plotId:"candle",yAlign:"right",type:"candle"}),volume:new si({chart:this,boardId:"sub",plotId:"volume",yAlign:"right",type:"volume"}),oi:new si({chart:this,boardId:"sub",plotId:"oi",yAlign:"left",type:"oi"})},this.marksManager=new ci(this),this.crosshair=new ne(this),this.chartController.init()}_initSvgNode(){this.svg=f("#"+this.divDomId).append("svg").attr("class","tqchart").attr("width",this.outerWidth).attr("height",this.outerHeight),this.defs=this.svg.append("defs");this.maskGlobal=yi.AppendMask(this.defs,"mask-global",this.innerWidth,this.innerHeight,0,0);const t=[this.margin.left,this.margin.top],e=t[0],i=t[1];this.backgroundG=yi.AppendG(this.svg,"background global",e,i),this.boardBackgroundG=yi.AppendG(this.svg,"boardBackground global",e,i),this.rootG=yi.AppendG(this.svg,"root global",e,i),this.crosshairG=yi.AppendG(this.svg,"crosshair global",e,i),this.loadingG=yi.AppendG(this.svg,"loading global",e,i),this.bgShapesG=yi.AppendG(this.svg,"bgShapes global",e,i,"mask-global"),this.backgroundText=this.backgroundG.append("g").append("text"),this.backgroundText.text(`${this.symbol} ${Ee(this.duration)}`).attr("dy","-2"),this.markG=this.rootG.append("g")}_debounce(t,e){let i=null;return function(){const s=this,r=arguments;clearTimeout(i),i=setTimeout((function(){t.apply(s,r)}),e)}}_initEventListenners(){const t=this;this.svg.on("mousemove",(function(){const e=Bt(m(this),2),i=e[0],s=e[1];i>t.margin.left&&i<t.margin.left+t.innerWidth&&s>t.margin.top&&s<t.margin.top+t.innerHeight&&t.crosshair.update(i-t.margin.left,s-t.margin.top)})),this.svg.on("mouseover",(function(){null===e&&t.crosshair.show()})),this.svg.on("mouseleave",(function(){t.crosshair.hide()}));let e=null;const i=g().on("start",(function(){e=p.x,t.crosshair.hide(),t.crosshair.drag(!0)})).on("drag",(function(){const i=Math.round((p.x-e)/t.bar.barWidth);this.bar=new mi(this.innerWidth),Math.abs(i)>0&&(e=p.x,t.move(i))})).on("end",(function(){e=null,t.crosshair.show(),t.crosshair.drag(!1)}));this.svg.call(i);const s=y().on("zoom",(function(){const e=p.sourceEvent.deltaY;Math.abs(e)>0&&t._debounce(t.zoom,200).bind(t)(e>0?-2:2)}));this.svg.call(s).on("dblclick.zoom",null)}getBoardByYPosition(t){for(const e in this.boards)if(t>=this.boards[e].top&&t<=this.boards[e].top+this.boards[e].height)return this.boards[e]}resize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.height,i=t.width;this.tqChartConsole.log("onresize",i),this.outerWidth=i,this.outerHeight=e,this.innerWidth=this.outerWidth-this.margin.left-this.margin.right,this.innerHeight=this.outerHeight-this.margin.top-this.margin.bottom,this.svg.attr("width",this.outerWidth).attr("height",this.outerHeight),this.bar.setFullWidth(this.innerWidth),this.xAxis.resetPosition(),this.chartController.zoom();const s=le.GetMutilPlotsHeight(Object.keys(this.boards).length,this.innerHeight);let r=0;for(const t in this.boards)this.boards[t].resetPosition(s[r++]);this.crosshair.resize(),this.draw()}_resetBoards(){for(const t in this.boards)"main"!==t&&"sub"!==t&&(this.boards[t].remove(),delete this.boards[t]);const t=le.GetMutilPlotsHeight(2,this.innerHeight);this.boards.main.resetPosition(t[0]),this.boards.sub.resetPosition(t[1]);for(const t in this.plots)"mainkline"!==t&&"volume"!==t&&"oi"!==t&&(this.plots[t].remove(),delete this.plots[t])}_updateBoards(){const t=le.GetMutilPlotsHeight(Object.keys(this.boards).length,this.innerHeight);let e=0;for(const i in this.boards)this.boards[i].resetPosition(t[e++])}addSeries(t,e){this.tqChartConsole.log("addSeries",t,e);const i=e.board?e.board.toLowerCase():"main";this.boards[i]||(this.boards[i]=new le(this,i,this.innerHeight,0,!0),this._updateBoards()),"KSERIAL"!==e.type&&"SERIAL"!==e.type||this.plots[t]||("KSERIAL"===e.type?this.plots[t]=new si({chart:this,boardId:i,plotId:t,yAlign:e.yAlign,type:"candle",data:e.data}):"SERIAL"===e.type&&(this.plots[t]=new si({chart:this,boardId:i,plotId:t,yAlign:e.yAlign,type:e.style.toLowerCase(),data:e.data,color:Ze(e.color),width:e.width,dash:"dash"===e.style.toLowerCase()}))),"TEXT"===e.type?this.addMark({id:t,boardId:e.board.toLowerCase(),type:"text",x1:e.x1,y1:e.y1,fill:Ze(e.color),size:e.size,text:e.text}):"LINE"===e.type||"SEG"===e.type||"RAY"===e.type?this.addMark({id:t,boardId:e.board.toLowerCase(),type:"line",x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,stroke:Ze(e.color),strokeWidth:e.width,text:"",clamp:!1}):"BOX"===e.type&&this.addMark({id:t,boardId:e.board.toLowerCase(),type:"rect",x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,fill:Ze(e.bg_color),stroke:Ze(e.color),strokeWidth:e.width||1}),this.draw()}addMark(t){this.marksManager.addMark(t)}removeMark(t){this.marksManager.removeMark(t)}removeMarkAll(){this.marksManager.removeMarkAll()}showMark(t){this.marksManager.showMark(t)}hideMark(t){this.marksManager.hideMark(t)}move(t){"fixed"!==this.mode&&this.chartController.move(t)&&this.draw()}zoom(t){if("fixed"===this.mode)return;const e=this.bar.barWidth;this.bar.zoom(t),e!==this.bar.barWidth&&(this.highlightManager.each("resize"),this.chartController.zoom(),this.xAxis.resetPosition(),this.draw())}readyToDraw(){return this.dm.readyToDraw()}draw(){if(-1===this.mainSeries.last_id)return;this.mainSeries.last_id-this.range.rightId==1&&this.chartController.setRange(this.mainSeries.last_id-this.bar.barNumbers+1,this.mainSeries.last_id);const t=this.chartController.getRange(),e=t.leftId,i=t.rightId;this.xAxis.draw(e,i,this.mainSeries.data);const s={};for(const t in this.plots){const r=this.plots[t].getYDomain(e,i,this.plots[t].data||this.mainSeries.data),n=this.plots[t].boardId,a=this.plots[t].yAlign;s[n]=s[n]||{left:[1/0,-1/0],right:[1/0,-1/0]},s[n][a][0]=Math.min(s[n][a][0],r[0]),s[n][a][1]=Math.max(s[n][a][1],r[1])}for(const t in this.boards){const r=s[t];r&&(this.boards[t].setDomain(r.left,"left"),this.boards[t].setDomain(r.right,"right"),this.boards[t].draw(e,i,this.mainSeries.data))}for(const t in this.plots)this.plots[t].draw(e,i,this.plots[t].data||this.mainSeries.data);this.marksManager.draw(),this.highlightManager.each("draw"),this.tradeArrowManager.draw(),this.positionManager.draw(),this.chartController.range.isEqual(this.range)||(this.range.copy(this.chartController.range),this.emit("showRangeChanged",this.range))}_drawBackground(e,i,s){const r=this.tqsdk.get_quote(this.symbol);if(r&&r.trading_time){const n=[],a=t("%H:%M:%S"),o=t("%d");if(this.duration<=6e10){const t=[];for(const e in r.trading_time.day)t.push(r.trading_time.day[e][0]);if(r.trading_time.night&&r.trading_time.night.length>0)for(const e in r.trading_time.night)t.push(r.trading_time.night[e][0]);for(let r=e;r<=i;r++)s[r]&&t.indexOf(a(s[r].datetime/1e6))>-1&&n.push((r-e)*this.bar.barWidth+this.bar.barWidth/2)}else if(this.duration<864e11){const t=[],o=r.trading_time.night?"night":"day";t.push(r.trading_time[o][0][0]);for(let r=e;r<=i;r++)s[r]&&t.indexOf(a(s[r].datetime/1e6))>-1&&n.push((r-e)*this.bar.barWidth+this.bar.barWidth/2)}else if(this.duration<=432e12)for(let t=e;t<=i;t++)s[t]&&s[t-1]&&o(s[t].datetime/1e6)<o(s[t-1].datetime/1e6)&&n.push((t-e)*this.bar.barWidth+this.bar.barWidth/2);const h=this.backgroundG.selectAll("line").data(n);h.enter().append("line").attr("y1",0).attr("y2",this.innerHeight).attr("stroke","#E6E6E6").attr("stroke-dasharray","12 6").attr("x1",t=>t).attr("x2",t=>t),h.merge(h).attr("x1",t=>t).attr("x2",t=>t),h.exit().remove()}}}yi.AppendG=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const n=t.append("g").attr("class",e);return 0===i&&0===s||n.attr("transform",`translate(${i},${s})`),r&&n.attr("mask",`url(#${r})`),n},yi.AppendMask=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return t.append("mask").attr("id",e).append("rect").attr("x",r).attr("y",n).attr("width",i).attr("height",s).style("fill","#FFFFFF").attr("stroke","none")},yi.version="0.0.1";export default yi;
